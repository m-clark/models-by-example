<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Expectation-Maximization | Model Estimation by Example</title>
  <meta name="description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Expectation-Maximization | Model Estimation by Example" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/models-by-example/" />
  <meta property="og:image" content="https://m-clark.github.io/models-by-example/img/title_plot.svg" />
  <meta property="og:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="github-repo" content="m-clark/models-by-example/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Expectation-Maximization | Model Estimation by Example" />
  
  <meta name="twitter:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="twitter:image" content="https://m-clark.github.io/models-by-example/img/title_plot.svg" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/R.ico" type="image/x-icon" />
<link rel="prev" href="nelder-mead.html"/>
<link rel="next" href="gradient-descent.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/book.css" type="text/css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class='before'><a href="./">Model Estimation by Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>Models</b></span></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i>Linear Regression</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#data-setup"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#estimation"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#comparison"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#python"><i class="fa fa-check"></i>Python</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i>Logistic Regression</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#data-setup-1"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#estimation-1"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#comparison-1"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#python-1"><i class="fa fa-check"></i>Python</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html"><i class="fa fa-check"></i>Mixed Models</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#one-factor-mixed-model"><i class="fa fa-check"></i>One-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#data-setup-2"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#function"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#estimation-2"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#comparison-2"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#source-2"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#two-factor-mixed-model"><i class="fa fa-check"></i>Two-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#data-setup-3"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#function-1"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#estimation-3"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#comparison-3"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#source-3"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#mixed-model-via-ml"><i class="fa fa-check"></i>Mixed Model via ML</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#data-setup-4"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#function-2"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#estimation-4"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#comparison-4"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#link-with-penalized-regression"><i class="fa fa-check"></i>Link with penalized regression</a></li>
<li class="chapter" data-level="" data-path="mixed-models.html"><a href="mixed-models.html#source-4"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html"><i class="fa fa-check"></i>Probit &amp; Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#standard-probit"><i class="fa fa-check"></i>Standard Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#function-3"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#examples"><i class="fa fa-check"></i>Examples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#bivariate-probit"><i class="fa fa-check"></i>Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#example"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#source-5"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html"><i class="fa fa-check"></i>Heckman Selection</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#data-setup-5"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#two-step-approach"><i class="fa fa-check"></i>Two step approach</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-1-probit-model"><i class="fa fa-check"></i>Step 1: Probit Model</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-2-estimate-via-linear-regression"><i class="fa fa-check"></i>Step 2: Estimate via Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#maximum-likelihood"><i class="fa fa-check"></i>Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#comparison-5"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#source-6"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html"><i class="fa fa-check"></i>Marginal Structural Model</a>
<ul>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#data-setup-6"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#function-4"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#estimation-5"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#comparison-6"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#source-7"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html"><i class="fa fa-check"></i>Tobit Regression</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#censoring-with-an-upper-limit"><i class="fa fa-check"></i>Censoring with an Upper Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#data-setup-7"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#function-5"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#estimation-6"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-7"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#censoring-with-a-lower-limit"><i class="fa fa-check"></i>Censoring with a Lower Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-8"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#source-8"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html"><i class="fa fa-check"></i>Cox Survival</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#standard-proportional-hazards"><i class="fa fa-check"></i>Standard Proportional Hazards</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#data-setup-8"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#function-6"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#estimation-7"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#comparison-9"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#time-varying-coefficients"><i class="fa fa-check"></i>Time-varying coefficients</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#data-setup-9"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#function-7"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#estimation-8"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#comparison-10"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#stratified-cox-model"><i class="fa fa-check"></i>Stratified Cox Model</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#data-setup-10"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#function-8"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#estimation-9"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#comparison-11"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#source-9"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html"><i class="fa fa-check"></i>Hurdle Model</a>
<ul>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#poisson"><i class="fa fa-check"></i>Poisson</a>
<ul>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#data-setup-11"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#function-9"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#estimation-10"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#comparison-12"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#negative-binomial"><i class="fa fa-check"></i>Negative Binomial</a>
<ul>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#function-10"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#estimation-11"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#comparison-13"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#source-10"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html"><i class="fa fa-check"></i>Zero-Inflated Model</a>
<ul>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#poisson-1"><i class="fa fa-check"></i>Poisson</a>
<ul>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#data-setup-12"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#function-11"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#estimation-12"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#comparison-14"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#negative-binomial-1"><i class="fa fa-check"></i>Negative Binomial</a>
<ul>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#function-12"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#estimation-13"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#comparison-15"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#supplemental-example"><i class="fa fa-check"></i>Supplemental Example</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#source-11"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html"><i class="fa fa-check"></i>Naive Bayes</a>
<ul>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#initialization"><i class="fa fa-check"></i>Initialization</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#comparison-16"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#source-12"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html"><i class="fa fa-check"></i>Multinomial Regression</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#standard-categorical-model"><i class="fa fa-check"></i>Standard (Categorical) Model</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#data-setup-13"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#function-13"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-17"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#alternative-specific-and-constant-variables"><i class="fa fa-check"></i>Alternative specific and constant variables</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-18"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#source-13"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i>Ordinal Regression</a>
<ul>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#function-14"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#estimation-14"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#comparison-19"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#source-14"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html"><i class="fa fa-check"></i>Markov Model</a>
<ul>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#data-setup-14"><i class="fa fa-check"></i>Data Setup</a>
<ul>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#data-functions"><i class="fa fa-check"></i>Data Functions</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#two-states-demo"><i class="fa fa-check"></i>Two states Demo</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#three-states-demo"><i class="fa fa-check"></i>Three states demo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#function-15"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#estimation-15"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#comparison-20"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#source-15"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html"><i class="fa fa-check"></i>Hidden Markov Model</a>
<ul>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#data-setup-15"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#function-16"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#estimation-16"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#supplemental-demo"><i class="fa fa-check"></i>Supplemental demo</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#source-16"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html"><i class="fa fa-check"></i>Quantile Regression</a>
<ul>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#data-setup-16"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#function-17"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#estimation-17"><i class="fa fa-check"></i>Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#other-quantiles"><i class="fa fa-check"></i>Other quantiles</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#comparison-21"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#visualize"><i class="fa fa-check"></i>Visualize</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#python-2"><i class="fa fa-check"></i>Python</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#source-17"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html"><i class="fa fa-check"></i>Cubic Spline Model</a>
<ul>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#data-setup-17"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#functions-2"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#example-1"><i class="fa fa-check"></i>Example 1</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#example-2"><i class="fa fa-check"></i>Example 2</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#source-18"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html"><i class="fa fa-check"></i>Gaussian Processes</a>
<ul>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#noise-free-demonstration"><i class="fa fa-check"></i>Noise-Free Demonstration</a>
<ul>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#data-setup-18"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#functions-3"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#visualize-the-prior-distribution"><i class="fa fa-check"></i>Visualize the prior distribution</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#generate-the-posterior-predictive-distribution"><i class="fa fa-check"></i>Generate the posterior predictive distribution</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#visualize-the-posterior-predictive-distribution"><i class="fa fa-check"></i>Visualize the Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#noisy-demonstration"><i class="fa fa-check"></i>Noisy Demonstration</a>
<ul>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#data-setup-19"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#functions-4"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#visualize-the-prior-distribution-1"><i class="fa fa-check"></i>Visualize the prior distribution</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#generate-the-posterior-predictive-distribution-1"><i class="fa fa-check"></i>Generate the posterior predictive distribution</a></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#visualize-the-posterior-predictive-distribution-1"><i class="fa fa-check"></i>Visualize the Posterior Predictive Distribution</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gaussian-process.html"><a href="gaussian-process.html#source-19"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html"><i class="fa fa-check"></i>Neural Network</a>
<ul>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#example-1-1"><i class="fa fa-check"></i>Example 1</a>
<ul>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#python-3"><i class="fa fa-check"></i>Python</a></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#r"><i class="fa fa-check"></i>R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#example-2-1"><i class="fa fa-check"></i>Example 2</a>
<ul>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#python-4"><i class="fa fa-check"></i>Python</a></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#r-1"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#comparison-22"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#example-3"><i class="fa fa-check"></i>Example 3</a>
<ul>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#python-5"><i class="fa fa-check"></i>Python</a></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#r-2"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#comparison-23"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="neural-network.html"><a href="neural-network.html#source-20"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html"><i class="fa fa-check"></i>Extreme Learning Machine</a>
<ul>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html#data-setup-20"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html#function-18"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html#estimation-18"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html#comparison-24"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html#supplemental-example-1"><i class="fa fa-check"></i>Supplemental Example</a></li>
<li class="chapter" data-level="" data-path="elm.html"><a href="elm.html#source-21"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html"><i class="fa fa-check"></i>Reproducing Kernel Hilbert Space Regression</a>
<ul>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#data-setup-21"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#functions-5"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#function-to-find-the-inverse-of-a-matrix"><i class="fa fa-check"></i>Function to find the inverse of a matrix</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#reproducing-kernel"><i class="fa fa-check"></i>Reproducing Kernel</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#gram-matrix"><i class="fa fa-check"></i>Gram matrix</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#ridge-regression"><i class="fa fa-check"></i>Ridge regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#estimation-19"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#comparison-25"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#example-cubic-spline"><i class="fa fa-check"></i>Example: Cubic Spline</a>
<ul>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#data-setup-22"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#functions-6"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#estimation-20"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#comparison-26"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#source-22"><i class="fa fa-check"></i>Source</a>
<ul>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#current-supplemental-code"><i class="fa fa-check"></i>Current Supplemental Code</a></li>
<li class="chapter" data-level="" data-path="rkhs.html"><a href="rkhs.html#original-supplemental-code"><i class="fa fa-check"></i>Original Supplemental Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html"><i class="fa fa-check"></i>Confirmatory Factor Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#data-setup-23"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#functions-7"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#estimation-21"><i class="fa fa-check"></i>Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#raw"><i class="fa fa-check"></i>Raw</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#standardized"><i class="fa fa-check"></i>Standardized</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#comparison-27"><i class="fa fa-check"></i>Comparison</a>
<ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#mplus"><i class="fa fa-check"></i>Mplus</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#source-23"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Bayesian</b></span></li>
<li class="chapter" data-level="" data-path="bayesian.html"><a href="bayesian.html"><i class="fa fa-check"></i>Introduction to Bayesian Methods</a></li>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html"><i class="fa fa-check"></i>Basics</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html#prior-likelihood-posterior-distributions"><i class="fa fa-check"></i>Prior, likelihood, &amp; posterior distributions</a></li>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html#prior"><i class="fa fa-check"></i>Prior</a></li>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html#likelihood"><i class="fa fa-check"></i>Likelihood</a></li>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html#posterior"><i class="fa fa-check"></i>Posterior</a></li>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html#posterior-predictive"><i class="fa fa-check"></i>Posterior predictive</a></li>
<li class="chapter" data-level="" data-path="bayesian-basics.html"><a href="bayesian-basics.html#source-24"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html"><i class="fa fa-check"></i>Bayesian t-test</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html#data-setup-24"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html#model-code"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html#estimation-22"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html#comparison-28"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html#visualization"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="bayesian-t-test.html"><a href="bayesian-t-test.html#source-25"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html"><i class="fa fa-check"></i>Bayesian Linear Regression</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html#data-setup-25"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html#model-code-1"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html#estimation-23"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html#comparison-29"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html#visualize-1"><i class="fa fa-check"></i>Visualize</a></li>
<li class="chapter" data-level="" data-path="bayesian-linear-regression.html"><a href="bayesian-linear-regression.html#source-26"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html"><i class="fa fa-check"></i>Bayesian Beta Regression</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html#data-setup-26"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html#model-code-2"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html#estimation-24"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html#comparison-30"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html#visualization-1"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="bayesian-beta-regression.html"><a href="bayesian-beta-regression.html#source-27"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html"><i class="fa fa-check"></i>Bayesian Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html#data-setup-27"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html#model-code-3"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html#estimation-25"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html#comparison-31"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html#visualize-2"><i class="fa fa-check"></i>Visualize</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-model.html"><a href="bayesian-mixed-model.html#source-28"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html"><i class="fa fa-check"></i>Bayesian Multilevel Mediation</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html#data-setup-28"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html#model-code-4"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html#estimation-26"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html#comparison-32"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html#visualization-2"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="bayesian-mixed-mediation.html"><a href="bayesian-mixed-mediation.html#source-29"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html"><i class="fa fa-check"></i>Bayesian IRT</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#one-parameter-irt"><i class="fa fa-check"></i>One Parameter IRT</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#data-setup-29"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#model-code-5"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#estimation-27"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#comparison-33"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#two-parameter-irt"><i class="fa fa-check"></i>Two Parameter IRT</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#model-code-6"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#estimation-28"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#comparison-34"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#three-parameter-irt"><i class="fa fa-check"></i>Three Parameter IRT</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#four-parameter-irt"><i class="fa fa-check"></i>Four Parameter IRT</a></li>
<li class="chapter" data-level="" data-path="bayesian-irt.html"><a href="bayesian-irt.html#source-30"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-cfa.html"><a href="bayesian-cfa.html"><i class="fa fa-check"></i>Bayesian CFA</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-cfa.html"><a href="bayesian-cfa.html#data-setup-30"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-cfa.html"><a href="bayesian-cfa.html#model-code-7"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-cfa.html"><a href="bayesian-cfa.html#estimation-29"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-cfa.html"><a href="bayesian-cfa.html#comparison-35"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-cfa.html"><a href="bayesian-cfa.html#source-31"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-non-parametric.html"><a href="bayesian-non-parametric.html"><i class="fa fa-check"></i>Bayesian Nonparametric Models</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-non-parametric.html"><a href="bayesian-non-parametric.html#chinese-restaurant-process"><i class="fa fa-check"></i>Chinese Restaurant Process</a></li>
<li class="chapter" data-level="" data-path="bayesian-non-parametric.html"><a href="bayesian-non-parametric.html#indian-buffet-process"><i class="fa fa-check"></i>Indian Buffet Process</a></li>
<li class="chapter" data-level="" data-path="bayesian-non-parametric.html"><a href="bayesian-non-parametric.html#source-32"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html"><i class="fa fa-check"></i>Bayesian Stochastic Volatility Model</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html#data-setup-31"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html#model-code-8"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html#estimation-30"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html#results"><i class="fa fa-check"></i>Results</a></li>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html#visualization-3"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="bayesian-stochastic-volatility.html"><a href="bayesian-stochastic-volatility.html#source-33"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html"><i class="fa fa-check"></i>Bayesian Multinomial Models</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html#data-setup-32"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html#model-code-9"><i class="fa fa-check"></i>Model Code</a></li>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html#estimation-31"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html#comparison-36"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html#adding-complexity"><i class="fa fa-check"></i>Adding Complexity</a></li>
<li class="chapter" data-level="" data-path="bayesian-multinomial-model.html"><a href="bayesian-multinomial-model.html#source-34"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html"><i class="fa fa-check"></i>Variational Bayes Regression</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#data-setup-33"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#function-19"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#estimation-32"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#comparison-37"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#visualization-4"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#supplemental-example-2"><i class="fa fa-check"></i>Supplemental Example</a></li>
<li class="chapter" data-level="" data-path="bayesian-variational.html"><a href="bayesian-variational.html#source-35"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bayesian-topic-model.html"><a href="bayesian-topic-model.html"><i class="fa fa-check"></i>Topic Model</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-topic-model.html"><a href="bayesian-topic-model.html#data-setup-34"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="bayesian-topic-model.html"><a href="bayesian-topic-model.html#function-20"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="bayesian-topic-model.html"><a href="bayesian-topic-model.html#estimation-33"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="bayesian-topic-model.html"><a href="bayesian-topic-model.html#comparison-38"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="bayesian-topic-model.html"><a href="bayesian-topic-model.html#source-36"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Estimation</b></span></li>
<li class="chapter" data-level="" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html"><i class="fa fa-check"></i>Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#example-4"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#linear-model"><i class="fa fa-check"></i>Linear Model</a></li>
<li class="chapter" data-level="" data-path="maximum-likelihood.html"><a href="maximum-likelihood.html#source-37"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html"><i class="fa fa-check"></i>Penalized Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#introduction-2"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-35"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#functions-8"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#estimation-34"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-39"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-38"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#l1-lasso-regularization"><i class="fa fa-check"></i>L1 (lasso) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-36"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#function-21"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#estimation-35"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-40"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-39"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#l2-ridge-regularization"><i class="fa fa-check"></i>L2 (ridge) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-37"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#function-22"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#estimation-36"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-41"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-40"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html"><i class="fa fa-check"></i>Newton and IRLS</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#data-setup-38"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#functions-9"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#newtons-method"><i class="fa fa-check"></i>Newton’s Method</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#irls"><i class="fa fa-check"></i>IRLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#estimation-37"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#comparison-42"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#source-41"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html"><i class="fa fa-check"></i>Nelder-Mead</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#functions-10"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#first-version"><i class="fa fa-check"></i>First Version</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-5"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model"><i class="fa fa-check"></i>A Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#second-version"><i class="fa fa-check"></i>Second Version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-6"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model-1"><i class="fa fa-check"></i>A Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#source-42"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html"><i class="fa fa-check"></i>Expectation-Maximization</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#mixture-model"><i class="fa fa-check"></i>Mixture Model</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#data-setup-40"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-23"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#estimation-38"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#comparison-45"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#visualization-5"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#supplemental-example-3"><i class="fa fa-check"></i>Supplemental Example</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-43"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#multivariate-mixture-model"><i class="fa fa-check"></i>Multivariate Mixture Model</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-24"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#example-1-old-faithful"><i class="fa fa-check"></i>Example 1: Old Faithful</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#example-2-iris"><i class="fa fa-check"></i>Example 2: Iris</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-44"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#probit-model"><i class="fa fa-check"></i>Probit Model</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#data-setup-43"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#probit-via-maximum-likelihood"><i class="fa fa-check"></i>Probit via Maximum Likelihood</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#em-for-latent-variable-approach-to-probit"><i class="fa fa-check"></i>EM for Latent Variable Approach to Probit</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-45"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#pca"><i class="fa fa-check"></i>PCA</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#data-setup-44"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-27"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#estimation-43"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#comparison-50"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#visualize-4"><i class="fa fa-check"></i>Visualize</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-46"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#probabilistic-pca"><i class="fa fa-check"></i>Probabilistic PCA</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#data-setup-45"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-28"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#estimation-44"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#comparison-51"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#visualize-5"><i class="fa fa-check"></i>Visualize</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#missing-data-example"><i class="fa fa-check"></i>Missing Data Example</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-47"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#state-space-model"><i class="fa fa-check"></i>State Space Model</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#data-setup-47"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-30"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#estimation-46"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#visualization-6"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-48"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html"><i class="fa fa-check"></i>Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#data-setup-48"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#function-31"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#estimation-47"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#comparison-53"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#source-49"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html"><i class="fa fa-check"></i>Stochastic Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-49"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#function-32"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#estimation-48"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-54"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates"><i class="fa fa-check"></i>Visualize Estimates</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-set-shift"><i class="fa fa-check"></i>Data Set Shift</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-50"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#estimation-49"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-55"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates-1"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#sgd-variants"><i class="fa fa-check"></i>SGD Variants</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-51"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#function-33"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#estimation-50"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-56"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates-2"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#source-50"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html"><i class="fa fa-check"></i>Metropolis Hastings</a>
<ul>
<li class="chapter" data-level="" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html#data-setup-52"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html#functions-11"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html#estimation-51"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html#comparison-57"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html#source-51"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hamiltonian-monte-carlo.html"><a href="hamiltonian-monte-carlo.html"><i class="fa fa-check"></i>Hamiltonian Monte Carlo</a>
<ul>
<li class="chapter" data-level="" data-path="hamiltonian-monte-carlo.html"><a href="hamiltonian-monte-carlo.html#data-setup-53"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="hamiltonian-monte-carlo.html"><a href="hamiltonian-monte-carlo.html#functions-12"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="hamiltonian-monte-carlo.html"><a href="hamiltonian-monte-carlo.html#estimation-52"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hamiltonian-monte-carlo.html"><a href="hamiltonian-monte-carlo.html#comparison-58"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="hamiltonian-monte-carlo.html"><a href="hamiltonian-monte-carlo.html#source-52"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Other</b></span></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html"><i class="fa fa-check"></i>Supplemental</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#other-languages"><i class="fa fa-check"></i>Other Languages</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#python-demos"><i class="fa fa-check"></i>Python Demos</a></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#julia-demos"><i class="fa fa-check"></i>Julia Demos</a></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#matlab-demos"><i class="fa fa-check"></i>Matlab Demos</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li class='after'">
   <a href="https://m-clark.github.io/">
      <img src="img/mc_logo.png" style="width:25%; padding:0px 0; display:block; margin: 0 auto;" alt="MC logo">
   </a>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a href="https://github.com/m-clark/">
         <i class="fab fa-github fa-2x" aria-hidden="true"></i>
      </a>
   </div>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
         <i class="fab fa-creative-commons fa-lg"></i>
         <i class="fab fa-creative-commons-by fa-lg"></i>
         <i class="fab fa-creative-commons-sa fa-lg"></i>
      </a>
   </div>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Model Estimation by Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="expectation-maximization" class="section level1">
<h1>Expectation-Maximization</h1>
<div id="mixture-model" class="section level2">
<h2>Mixture Model</h2>
<p>The following code is based on algorithms noted in Murphy, 2012 Probabilistic Machine Learning, specifically, Chapter 11, section 4.</p>
<div id="data-setup-40" class="section level3">
<h3>Data Setup</h3>
<p>This example uses Old Faithful geyser eruptions. This is only a univariate
mixture for either eruption time or wait time. The <a href="em.html#multivariate-mixture-model">next example</a> will be doing both variables, i.e. multivariate normal. ‘Geyser’
is supposedly more accurate, though seems to have arbitrarily assigned some
duration values. See <a href="http://www.geyserstudy.org/geyser.aspx?pGeyserNo=OLDFAITHFUL">this
source</a> also, but
that only has intervals. Some July 1995 data is available.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="em.html#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb682-2"><a href="em.html#cb682-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-3"><a href="em.html#cb682-3" aria-hidden="true" tabindex="-1"></a><span class="co"># faithful data set is in base R</span></span>
<span id="cb682-4"><a href="em.html#cb682-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(faithful)</span>
<span id="cb682-5"><a href="em.html#cb682-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb682-6"><a href="em.html#cb682-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(faithful)</span></code></pre></div>
<pre><code>  eruptions waiting
1     3.600      79
2     1.800      54
3     3.333      74
4     2.283      62
5     4.533      85
6     2.883      55</code></pre>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="em.html#cb684-1" aria-hidden="true" tabindex="-1"></a>eruptions  <span class="ot">=</span> <span class="fu">as.matrix</span>(faithful[, <span class="dv">1</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb684-2"><a href="em.html#cb684-2" aria-hidden="true" tabindex="-1"></a>wait_times <span class="ot">=</span> <span class="fu">as.matrix</span>(faithful[, <span class="dv">2</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span></code></pre></div>
</div>
<div id="function-23" class="section level3">
<h3>Function</h3>
<p>The fitting function.</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="em.html#cb685-1" aria-hidden="true" tabindex="-1"></a>em_mixture <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb685-2"><a href="em.html#cb685-2" aria-hidden="true" tabindex="-1"></a>  params,</span>
<span id="cb685-3"><a href="em.html#cb685-3" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb685-4"><a href="em.html#cb685-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="dv">2</span>,</span>
<span id="cb685-5"><a href="em.html#cb685-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol =</span> .<span class="dv">00001</span>,</span>
<span id="cb685-6"><a href="em.html#cb685-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits  =</span> <span class="dv">100</span>,</span>
<span id="cb685-7"><a href="em.html#cb685-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits =</span> <span class="cn">TRUE</span></span>
<span id="cb685-8"><a href="em.html#cb685-8" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb685-9"><a href="em.html#cb685-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-10"><a href="em.html#cb685-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments are starting parameters (means, covariances, cluster probability),</span></span>
<span id="cb685-11"><a href="em.html#cb685-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data, number of clusters desired, tolerance, maximum iterations, and whether</span></span>
<span id="cb685-12"><a href="em.html#cb685-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to show iterations</span></span>
<span id="cb685-13"><a href="em.html#cb685-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-14"><a href="em.html#cb685-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Starting points</span></span>
<span id="cb685-15"><a href="em.html#cb685-15" aria-hidden="true" tabindex="-1"></a>  N     <span class="ot">=</span> <span class="fu">nrow</span>(X)</span>
<span id="cb685-16"><a href="em.html#cb685-16" aria-hidden="true" tabindex="-1"></a>  nams  <span class="ot">=</span> <span class="fu">names</span>(params)</span>
<span id="cb685-17"><a href="em.html#cb685-17" aria-hidden="true" tabindex="-1"></a>  mu    <span class="ot">=</span> params<span class="sc">$</span>mu</span>
<span id="cb685-18"><a href="em.html#cb685-18" aria-hidden="true" tabindex="-1"></a>  var   <span class="ot">=</span> params<span class="sc">$</span>var</span>
<span id="cb685-19"><a href="em.html#cb685-19" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">=</span> params<span class="sc">$</span>probs</span>
<span id="cb685-20"><a href="em.html#cb685-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-21"><a href="em.html#cb685-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Other initializations</span></span>
<span id="cb685-22"><a href="em.html#cb685-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize cluster &#39;responsibilities&#39;, i.e. probability of cluster</span></span>
<span id="cb685-23"><a href="em.html#cb685-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># membership for each observation i</span></span>
<span id="cb685-24"><a href="em.html#cb685-24" aria-hidden="true" tabindex="-1"></a>  ri <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol =</span> clusters, <span class="at">nrow =</span> N) </span>
<span id="cb685-25"><a href="em.html#cb685-25" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb685-26"><a href="em.html#cb685-26" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb685-27"><a href="em.html#cb685-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-28"><a href="em.html#cb685-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                  <span class="co"># Show iterations</span></span>
<span id="cb685-29"><a href="em.html#cb685-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb685-30"><a href="em.html#cb685-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-31"><a href="em.html#cb685-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> ((<span class="sc">!</span>converged) <span class="sc">&amp;</span> (it <span class="sc">&lt;</span> maxits)) { </span>
<span id="cb685-32"><a href="em.html#cb685-32" aria-hidden="true" tabindex="-1"></a>    probsOld <span class="ot">=</span> probs</span>
<span id="cb685-33"><a href="em.html#cb685-33" aria-hidden="true" tabindex="-1"></a>    muOld <span class="ot">=</span> mu</span>
<span id="cb685-34"><a href="em.html#cb685-34" aria-hidden="true" tabindex="-1"></a>    varOld <span class="ot">=</span> var</span>
<span id="cb685-35"><a href="em.html#cb685-35" aria-hidden="true" tabindex="-1"></a>    riOld <span class="ot">=</span> ri</span>
<span id="cb685-36"><a href="em.html#cb685-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-37"><a href="em.html#cb685-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># E</span></span>
<span id="cb685-38"><a href="em.html#cb685-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute responsibilities</span></span>
<span id="cb685-39"><a href="em.html#cb685-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>clusters){</span>
<span id="cb685-40"><a href="em.html#cb685-40" aria-hidden="true" tabindex="-1"></a>      ri[, k] <span class="ot">=</span> probs[k] <span class="sc">*</span> <span class="fu">dnorm</span>(X, mu[k], <span class="at">sd =</span> <span class="fu">sqrt</span>(var[k]), <span class="at">log =</span> <span class="cn">FALSE</span>)</span>
<span id="cb685-41"><a href="em.html#cb685-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb685-42"><a href="em.html#cb685-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-43"><a href="em.html#cb685-43" aria-hidden="true" tabindex="-1"></a>    ri <span class="ot">=</span> ri<span class="sc">/</span><span class="fu">rowSums</span>(ri)</span>
<span id="cb685-44"><a href="em.html#cb685-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-45"><a href="em.html#cb685-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M</span></span>
<span id="cb685-46"><a href="em.html#cb685-46" aria-hidden="true" tabindex="-1"></a>    rk <span class="ot">=</span> <span class="fu">colSums</span>(ri)           <span class="co"># rk is the weighted average cluster membership size</span></span>
<span id="cb685-47"><a href="em.html#cb685-47" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">=</span> rk<span class="sc">/</span>N</span>
<span id="cb685-48"><a href="em.html#cb685-48" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> (<span class="fu">t</span>(X) <span class="sc">%*%</span> ri) <span class="sc">/</span> rk    </span>
<span id="cb685-49"><a href="em.html#cb685-49" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">=</span> (<span class="fu">t</span>(X<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%*%</span> ri) <span class="sc">/</span> rk <span class="sc">-</span> mu<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb685-50"><a href="em.html#cb685-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-51"><a href="em.html#cb685-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># could do mu and var via log likelihood here, but this is more straightforward</span></span>
<span id="cb685-52"><a href="em.html#cb685-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb685-53"><a href="em.html#cb685-53" aria-hidden="true" tabindex="-1"></a>    parmlistold     <span class="ot">=</span> <span class="fu">rbind</span>(probsOld, muOld, varOld)</span>
<span id="cb685-54"><a href="em.html#cb685-54" aria-hidden="true" tabindex="-1"></a>    parmlistcurrent <span class="ot">=</span> <span class="fu">rbind</span>(probs, mu, var)</span>
<span id="cb685-55"><a href="em.html#cb685-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-56"><a href="em.html#cb685-56" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb685-57"><a href="em.html#cb685-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-58"><a href="em.html#cb685-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if showits true, &amp; it =1 or divisible by 5 print message</span></span>
<span id="cb685-59"><a href="em.html#cb685-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>)        </span>
<span id="cb685-60"><a href="em.html#cb685-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb685-61"><a href="em.html#cb685-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb685-62"><a href="em.html#cb685-62" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(parmlistold <span class="sc">-</span> parmlistcurrent)) <span class="sc">&lt;=</span> tol</span>
<span id="cb685-63"><a href="em.html#cb685-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb685-64"><a href="em.html#cb685-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-65"><a href="em.html#cb685-65" aria-hidden="true" tabindex="-1"></a>  clust <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">round</span>(ri) <span class="sc">==</span> <span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>) <span class="co"># create cluster membership</span></span>
<span id="cb685-66"><a href="em.html#cb685-66" aria-hidden="true" tabindex="-1"></a>  clust <span class="ot">=</span> clust[<span class="fu">order</span>(clust[, <span class="dv">1</span>]), <span class="dv">2</span>]           <span class="co"># order according to row rather than cluster</span></span>
<span id="cb685-67"><a href="em.html#cb685-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-68"><a href="em.html#cb685-68" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb685-69"><a href="em.html#cb685-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs   =</span> probs,</span>
<span id="cb685-70"><a href="em.html#cb685-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu      =</span> mu,</span>
<span id="cb685-71"><a href="em.html#cb685-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">var     =</span> var,</span>
<span id="cb685-72"><a href="em.html#cb685-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">resp    =</span> ri,</span>
<span id="cb685-73"><a href="em.html#cb685-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster =</span> clust</span>
<span id="cb685-74"><a href="em.html#cb685-74" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb685-75"><a href="em.html#cb685-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb685-76"><a href="em.html#cb685-76" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb685-77"><a href="em.html#cb685-77" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
</div>
<div id="estimation-38" class="section level3">
<h3>Estimation</h3>
<p>Starting parameters require mean, variance and class probability. Note that starting values for mean must be within the data range or it will break.</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="em.html#cb686-1" aria-hidden="true" tabindex="-1"></a>start_values_1 <span class="ot">=</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb686-2"><a href="em.html#cb686-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">var =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb686-3"><a href="em.html#cb686-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>))</span>
<span id="cb686-4"><a href="em.html#cb686-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb686-5"><a href="em.html#cb686-5" aria-hidden="true" tabindex="-1"></a>start_values_2 <span class="ot">=</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">90</span>),</span>
<span id="cb686-6"><a href="em.html#cb686-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">var =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">15</span>),</span>
<span id="cb686-7"><a href="em.html#cb686-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>)) </span></code></pre></div>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="em.html#cb687-1" aria-hidden="true" tabindex="-1"></a>mix_erupt   <span class="ot">=</span> <span class="fu">em_mixture</span>(start_values_1, <span class="at">X =</span> eruptions,  <span class="at">tol =</span> <span class="fl">1e-8</span>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...
10...
15...
20...
25...
30...</code></pre>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="em.html#cb689-1" aria-hidden="true" tabindex="-1"></a>mix_waiting <span class="ot">=</span> <span class="fu">em_mixture</span>(start_values_2, <span class="at">X =</span> wait_times, <span class="at">tol =</span> <span class="fl">1e-8</span>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...
10...
15...
20...
25...
30...
35...
40...
45...
50...
55...</code></pre>
</div>
<div id="comparison-45" class="section level3">
<h3>Comparison</h3>
<p>Compare to <span class="pack" style="">flexmix</span> package results.</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="em.html#cb691-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexmix)</span>
<span id="cb691-2"><a href="em.html#cb691-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-3"><a href="em.html#cb691-3" aria-hidden="true" tabindex="-1"></a>flex_erupt <span class="ot">=</span> <span class="fu">flexmix</span>(eruptions <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb691-4"><a href="em.html#cb691-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">k =</span> <span class="dv">2</span>,</span>
<span id="cb691-5"><a href="em.html#cb691-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control =</span> <span class="fu">list</span>(<span class="at">tolerance =</span> <span class="fl">1e-8</span>, <span class="at">iter.max =</span> <span class="dv">100</span>))</span>
<span id="cb691-6"><a href="em.html#cb691-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-7"><a href="em.html#cb691-7" aria-hidden="true" tabindex="-1"></a>flex_wait <span class="ot">=</span> <span class="fu">flexmix</span>(wait_times <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb691-8"><a href="em.html#cb691-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">k =</span> <span class="dv">2</span>,</span>
<span id="cb691-9"><a href="em.html#cb691-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">tolerance =</span> <span class="fl">1e-8</span>, <span class="at">iter.max =</span> <span class="dv">100</span>))</span></code></pre></div>
<p>The following provides means, variances and probability of group membership. Note that the cluster label is arbitrary so cluster 1 for one model may be cluster 2 in another.</p>
<div id="eruptions" class="section level5">
<h5>Eruptions</h5>
<p>First we’ll compare results on the eruptions variable.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="em.html#cb692-1" aria-hidden="true" tabindex="-1"></a>mean_var <span class="ot">=</span> <span class="fu">rbind</span>(mix_erupt<span class="sc">$</span>mu, <span class="fu">sqrt</span>(mix_erupt<span class="sc">$</span>var))</span>
<span id="cb692-2"><a href="em.html#cb692-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb692-3"><a href="em.html#cb692-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mean_var) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;cluster 1&#39;</span>, <span class="st">&#39;cluster 2&#39;</span>)</span>
<span id="cb692-4"><a href="em.html#cb692-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-5"><a href="em.html#cb692-5" aria-hidden="true" tabindex="-1"></a>mean_var_flex <span class="ot">=</span> <span class="fu">parameters</span>(flex_erupt)</span>
<span id="cb692-6"><a href="em.html#cb692-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var_flex) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb692-7"><a href="em.html#cb692-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mean_var_flex) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;cluster 1 flex&#39;</span>, <span class="st">&#39;cluster 2 flex&#39;</span>)</span>
<span id="cb692-8"><a href="em.html#cb692-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-9"><a href="em.html#cb692-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-10"><a href="em.html#cb692-10" aria-hidden="true" tabindex="-1"></a>prob_membership      <span class="ot">=</span> mix_erupt<span class="sc">$</span>probs</span>
<span id="cb692-11"><a href="em.html#cb692-11" aria-hidden="true" tabindex="-1"></a>prob_membership_flex <span class="ot">=</span> flex_erupt<span class="sc">@</span>size <span class="sc">/</span> <span class="fu">sum</span>(flex_erupt<span class="sc">@</span>size)</span>
<span id="cb692-12"><a href="em.html#cb692-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-13"><a href="em.html#cb692-13" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb692-14"><a href="em.html#cb692-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">cbind</span>(mean_var, mean_var_flex),</span>
<span id="cb692-15"><a href="em.html#cb692-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterpobs =</span> <span class="fu">cbind</span>(prob_membership, prob_membership_flex)</span>
<span id="cb692-16"><a href="em.html#cb692-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>$params
          cluster 1 cluster 2 cluster 1 flex cluster 2 flex
means     2.0186078 4.2733434      2.0186378      4.2733671
variances 0.2356218 0.4370631      0.2361087      0.4378364

$clusterpobs
  prob_membership prob_membership_flex
1       0.3484046            0.3492647
2       0.6515954            0.6507353</code></pre>
</div>
<div id="waiting" class="section level5">
<h5>Waiting</h5>
<p>Now we compare the result for waiting times.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="em.html#cb694-1" aria-hidden="true" tabindex="-1"></a>mean_var <span class="ot">=</span> <span class="fu">rbind</span>(mix_waiting<span class="sc">$</span>mu, <span class="fu">sqrt</span>(mix_waiting<span class="sc">$</span>var))</span>
<span id="cb694-2"><a href="em.html#cb694-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb694-3"><a href="em.html#cb694-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mean_var) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;cluster 1&#39;</span>, <span class="st">&#39;cluster 2&#39;</span>)</span>
<span id="cb694-4"><a href="em.html#cb694-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-5"><a href="em.html#cb694-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-6"><a href="em.html#cb694-6" aria-hidden="true" tabindex="-1"></a>mean_var_flex <span class="ot">=</span> <span class="fu">parameters</span>(flex_wait)</span>
<span id="cb694-7"><a href="em.html#cb694-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var_flex) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb694-8"><a href="em.html#cb694-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mean_var_flex) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;cluster 1 flex&#39;</span>, <span class="st">&#39;cluster 2 flex&#39;</span>)</span>
<span id="cb694-9"><a href="em.html#cb694-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-10"><a href="em.html#cb694-10" aria-hidden="true" tabindex="-1"></a>prob_membership      <span class="ot">=</span> mix_waiting<span class="sc">$</span>probs</span>
<span id="cb694-11"><a href="em.html#cb694-11" aria-hidden="true" tabindex="-1"></a>prob_membership_flex <span class="ot">=</span> flex_wait<span class="sc">@</span>size <span class="sc">/</span> <span class="fu">sum</span>(flex_wait<span class="sc">@</span>size)</span>
<span id="cb694-12"><a href="em.html#cb694-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-13"><a href="em.html#cb694-13" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb694-14"><a href="em.html#cb694-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">cbind</span>(mean_var, mean_var_flex),</span>
<span id="cb694-15"><a href="em.html#cb694-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterpobs =</span> <span class="fu">cbind</span>(prob_membership, prob_membership_flex)</span>
<span id="cb694-16"><a href="em.html#cb694-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>$params
          cluster 1 cluster 2 cluster 1 flex cluster 2 flex
means     54.614856 80.091069      54.616631      80.090988
variances  5.871219  5.867734       5.884843       5.879324

$clusterpobs
  prob_membership prob_membership_flex
1       0.3608861            0.3639706
2       0.6391139            0.6360294</code></pre>
</div>
</div>
<div id="visualization-5" class="section level3">
<h3>Visualization</h3>
<p>Points are colored by class membership, followed by the probability of being in cluster 1.</p>
<p><img src="model-demos_files/figure-html/gaussEM-vis-1.svg" width="75%" style="display: block; margin: auto;" /><img src="model-demos_files/figure-html/gaussEM-vis-2.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="supplemental-example-3" class="section level3">
<h3>Supplemental Example</h3>
<p>This uses the <span class="pack" style="">MASS</span> version (reversed columns). These don’t look even remotely the same data on initial inspection- <code>geyser</code> is even more rounded and of opposite conclusion. Turns out geyser is offset by 1, such that duration 1 should be coupled with waiting 2 and on down. Still the rounding at 2 and 4 (and whatever division was done on duration) makes this fairly poor data.</p>
<p>I’ve cleaned this up a little bit in case someone wants to play with it for additional practice, but it’s not evaluated.</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="em.html#cb696-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(geyser, <span class="at">package =</span> <span class="st">&#39;MASS&#39;</span>)</span>
<span id="cb696-2"><a href="em.html#cb696-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-3"><a href="em.html#cb696-3" aria-hidden="true" tabindex="-1"></a>geyser <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">duration =</span> geyser<span class="sc">$</span>duration[<span class="sc">-</span><span class="dv">299</span>], <span class="at">waiting =</span> geyser<span class="sc">$</span>waiting[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb696-4"><a href="em.html#cb696-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-5"><a href="em.html#cb696-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare to faithful</span></span>
<span id="cb696-6"><a href="em.html#cb696-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb696-7"><a href="em.html#cb696-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-8"><a href="em.html#cb696-8" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">data =</span> faithful, <span class="at">x =</span> eruptions, <span class="at">y =</span> waiting, <span class="at">alpha =</span> <span class="fu">I</span>(.<span class="dv">25</span>)) <span class="sc">/</span></span>
<span id="cb696-9"><a href="em.html#cb696-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qplot</span>(<span class="at">data =</span> geyser, <span class="at">x =</span> duration,  <span class="at">y =</span> waiting, <span class="at">alpha =</span> <span class="fu">I</span>(.<span class="dv">25</span>))</span>
<span id="cb696-10"><a href="em.html#cb696-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-11"><a href="em.html#cb696-11" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">=</span> <span class="fu">matrix</span>(geyser[,<span class="dv">1</span>]) </span>
<span id="cb696-12"><a href="em.html#cb696-12" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">=</span> <span class="fu">matrix</span>(geyser[,<span class="dv">2</span>])</span>
<span id="cb696-13"><a href="em.html#cb696-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-14"><a href="em.html#cb696-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-15"><a href="em.html#cb696-15" aria-hidden="true" tabindex="-1"></a><span class="co"># MASS version</span></span>
<span id="cb696-16"><a href="em.html#cb696-16" aria-hidden="true" tabindex="-1"></a>test3 <span class="ot">=</span> <span class="fu">em_mixture</span>(start_values_1, <span class="at">X =</span> X3, <span class="at">tol =</span> <span class="fl">1e-8</span>)</span>
<span id="cb696-17"><a href="em.html#cb696-17" aria-hidden="true" tabindex="-1"></a>test4 <span class="ot">=</span> <span class="fu">em_mixture</span>(start_values_2, <span class="at">X =</span> X4, <span class="at">tol =</span> <span class="fl">1e-8</span>)</span>
<span id="cb696-18"><a href="em.html#cb696-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-19"><a href="em.html#cb696-19" aria-hidden="true" tabindex="-1"></a>flexmod3 <span class="ot">=</span> <span class="fu">flexmix</span>(X3 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb696-20"><a href="em.html#cb696-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">k =</span> <span class="dv">2</span>,</span>
<span id="cb696-21"><a href="em.html#cb696-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">list</span>(<span class="at">tolerance =</span> <span class="fl">1e-8</span>, <span class="at">iter.max =</span> <span class="dv">100</span>))</span>
<span id="cb696-22"><a href="em.html#cb696-22" aria-hidden="true" tabindex="-1"></a>flexmod4 <span class="ot">=</span> <span class="fu">flexmix</span>(X4 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb696-23"><a href="em.html#cb696-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">k =</span> <span class="dv">2</span>,</span>
<span id="cb696-24"><a href="em.html#cb696-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">list</span>(<span class="at">tolerance =</span> <span class="fl">1e-8</span>, <span class="at">iter.max =</span> <span class="dv">100</span>))</span>
<span id="cb696-25"><a href="em.html#cb696-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-26"><a href="em.html#cb696-26" aria-hidden="true" tabindex="-1"></a><span class="co"># note variability differences compared to faithful dataset</span></span>
<span id="cb696-27"><a href="em.html#cb696-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Eruptions/Duration</span></span>
<span id="cb696-28"><a href="em.html#cb696-28" aria-hidden="true" tabindex="-1"></a>mean_var <span class="ot">=</span> <span class="fu">rbind</span>(test3<span class="sc">$</span>mu, <span class="fu">sqrt</span>(test3<span class="sc">$</span>var))</span>
<span id="cb696-29"><a href="em.html#cb696-29" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb696-30"><a href="em.html#cb696-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-31"><a href="em.html#cb696-31" aria-hidden="true" tabindex="-1"></a>mean_var_flex <span class="ot">=</span> <span class="fu">parameters</span>(flexmod3)</span>
<span id="cb696-32"><a href="em.html#cb696-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var_flex) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb696-33"><a href="em.html#cb696-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-34"><a href="em.html#cb696-34" aria-hidden="true" tabindex="-1"></a>prob_membership <span class="ot">=</span> test3<span class="sc">$</span>probs</span>
<span id="cb696-35"><a href="em.html#cb696-35" aria-hidden="true" tabindex="-1"></a>prob_membership_flex <span class="ot">=</span> flexmod3<span class="sc">@</span>size <span class="sc">/</span> <span class="fu">sum</span>(flexmod3<span class="sc">@</span>size)</span>
<span id="cb696-36"><a href="em.html#cb696-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-37"><a href="em.html#cb696-37" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb696-38"><a href="em.html#cb696-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">cbind</span>(mean_var, mean_var_flex),</span>
<span id="cb696-39"><a href="em.html#cb696-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterpobs =</span> <span class="fu">cbind</span>(prob_membership, prob_membership_flex)</span>
<span id="cb696-40"><a href="em.html#cb696-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb696-41"><a href="em.html#cb696-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-42"><a href="em.html#cb696-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Waiting</span></span>
<span id="cb696-43"><a href="em.html#cb696-43" aria-hidden="true" tabindex="-1"></a>mean_var <span class="ot">=</span> <span class="fu">rbind</span>(test4<span class="sc">$</span>mu, <span class="fu">sqrt</span>(test4<span class="sc">$</span>var))</span>
<span id="cb696-44"><a href="em.html#cb696-44" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb696-45"><a href="em.html#cb696-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-46"><a href="em.html#cb696-46" aria-hidden="true" tabindex="-1"></a>mean_var_flex <span class="ot">=</span> <span class="fu">parameters</span>(flexmod4)</span>
<span id="cb696-47"><a href="em.html#cb696-47" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mean_var_flex) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;means&#39;</span>, <span class="st">&#39;variances&#39;</span>)</span>
<span id="cb696-48"><a href="em.html#cb696-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-49"><a href="em.html#cb696-49" aria-hidden="true" tabindex="-1"></a>prob_membership <span class="ot">=</span> test4<span class="sc">$</span>probs</span>
<span id="cb696-50"><a href="em.html#cb696-50" aria-hidden="true" tabindex="-1"></a>prob_membership_flex <span class="ot">=</span> flexmod4<span class="sc">@</span>size <span class="sc">/</span> <span class="fu">sum</span>(flexmod4<span class="sc">@</span>size)</span>
<span id="cb696-51"><a href="em.html#cb696-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-52"><a href="em.html#cb696-52" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb696-53"><a href="em.html#cb696-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">cbind</span>(mean_var, mean_var_flex),</span>
<span id="cb696-54"><a href="em.html#cb696-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterpobs =</span> <span class="fu">cbind</span>(prob_membership, prob_membership_flex)</span>
<span id="cb696-55"><a href="em.html#cb696-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb696-56"><a href="em.html#cb696-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-57"><a href="em.html#cb696-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Some plots</span></span>
<span id="cb696-58"><a href="em.html#cb696-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb696-59"><a href="em.html#cb696-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-60"><a href="em.html#cb696-60" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> waiting, <span class="at">data =</span> faithful)</span>
<span id="cb696-61"><a href="em.html#cb696-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-62"><a href="em.html#cb696-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> waiting), <span class="at">data =</span> faithful) <span class="sc">+</span></span>
<span id="cb696-63"><a href="em.html#cb696-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(mix_waiting<span class="sc">$</span>cluster)))</span>
<span id="cb696-64"><a href="em.html#cb696-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-65"><a href="em.html#cb696-65" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> waiting), <span class="at">data =</span> faithful) <span class="sc">+</span></span>
<span id="cb696-66"><a href="em.html#cb696-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> mix_waiting<span class="sc">$</span>resp[, <span class="dv">1</span>]))</span></code></pre></div>
</div>
<div id="source-43" class="section level3">
<h3>Source</h3>
<p>Original code available at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20Mixture.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20Mixture.R</a></p>
</div>
</div>
<div id="multivariate-mixture-model" class="section level2">
<h2>Multivariate Mixture Model</h2>
<p>The following code is based on algorithms noted in Murphy, 2012 Probabilistic Machine Learning.
Specifically, Chapter 11, section 4.</p>
<div id="function-24" class="section level3">
<h3>Function</h3>
<p>This estimating function will be used for both examples.</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="em.html#cb697-1" aria-hidden="true" tabindex="-1"></a>em_mixture <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb697-2"><a href="em.html#cb697-2" aria-hidden="true" tabindex="-1"></a>  params,</span>
<span id="cb697-3"><a href="em.html#cb697-3" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb697-4"><a href="em.html#cb697-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="dv">2</span>,</span>
<span id="cb697-5"><a href="em.html#cb697-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol =</span> .<span class="dv">00001</span>,</span>
<span id="cb697-6"><a href="em.html#cb697-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits   =</span> <span class="dv">100</span>,</span>
<span id="cb697-7"><a href="em.html#cb697-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits  =</span> <span class="cn">TRUE</span></span>
<span id="cb697-8"><a href="em.html#cb697-8" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb697-9"><a href="em.html#cb697-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-10"><a href="em.html#cb697-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments are </span></span>
<span id="cb697-11"><a href="em.html#cb697-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># params: starting parameters (means, covariances, cluster probability)</span></span>
<span id="cb697-12"><a href="em.html#cb697-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X: data </span></span>
<span id="cb697-13"><a href="em.html#cb697-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters: number of clusters desired</span></span>
<span id="cb697-14"><a href="em.html#cb697-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tol: tolerance</span></span>
<span id="cb697-15"><a href="em.html#cb697-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># maxits: maximum iterations</span></span>
<span id="cb697-16"><a href="em.html#cb697-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># showits: whether to show iterations</span></span>
<span id="cb697-17"><a href="em.html#cb697-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-18"><a href="em.html#cb697-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(mvtnorm)</span>
<span id="cb697-19"><a href="em.html#cb697-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Starting points</span></span>
<span id="cb697-20"><a href="em.html#cb697-20" aria-hidden="true" tabindex="-1"></a>  N     <span class="ot">=</span> <span class="fu">nrow</span>(X)</span>
<span id="cb697-21"><a href="em.html#cb697-21" aria-hidden="true" tabindex="-1"></a>  mu    <span class="ot">=</span> params<span class="sc">$</span>mu</span>
<span id="cb697-22"><a href="em.html#cb697-22" aria-hidden="true" tabindex="-1"></a>  var   <span class="ot">=</span> params<span class="sc">$</span>var</span>
<span id="cb697-23"><a href="em.html#cb697-23" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">=</span> params<span class="sc">$</span>probs</span>
<span id="cb697-24"><a href="em.html#cb697-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-25"><a href="em.html#cb697-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initializations</span></span>
<span id="cb697-26"><a href="em.html#cb697-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-27"><a href="em.html#cb697-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cluster &#39;responsibilities&#39;, i.e. probability of cluster membership for each</span></span>
<span id="cb697-28"><a href="em.html#cb697-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># observation i</span></span>
<span id="cb697-29"><a href="em.html#cb697-29" aria-hidden="true" tabindex="-1"></a>  ri <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol=</span>clusters, <span class="at">nrow=</span>N)       </span>
<span id="cb697-30"><a href="em.html#cb697-30" aria-hidden="true" tabindex="-1"></a>  ll <span class="ot">=</span> <span class="dv">0</span>                                        <span class="co"># log likelihood</span></span>
<span id="cb697-31"><a href="em.html#cb697-31" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span>                                        <span class="co"># iteration count</span></span>
<span id="cb697-32"><a href="em.html#cb697-32" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span>                             <span class="co"># convergence</span></span>
<span id="cb697-33"><a href="em.html#cb697-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-34"><a href="em.html#cb697-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show iterations if showits == true</span></span>
<span id="cb697-35"><a href="em.html#cb697-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                  </span>
<span id="cb697-36"><a href="em.html#cb697-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb697-37"><a href="em.html#cb697-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-38"><a href="em.html#cb697-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="sc">!</span>converged <span class="sc">&amp;</span> it <span class="sc">&lt;</span> maxits) { </span>
<span id="cb697-39"><a href="em.html#cb697-39" aria-hidden="true" tabindex="-1"></a>    probsOld <span class="ot">=</span> probs</span>
<span id="cb697-40"><a href="em.html#cb697-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># muOld = mu                # Use direct values or loglike for convergence check</span></span>
<span id="cb697-41"><a href="em.html#cb697-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># varOld = var</span></span>
<span id="cb697-42"><a href="em.html#cb697-42" aria-hidden="true" tabindex="-1"></a>    llOld <span class="ot">=</span> ll</span>
<span id="cb697-43"><a href="em.html#cb697-43" aria-hidden="true" tabindex="-1"></a>    riOld <span class="ot">=</span> ri</span>
<span id="cb697-44"><a href="em.html#cb697-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-45"><a href="em.html#cb697-45" aria-hidden="true" tabindex="-1"></a>    <span class="do">### E</span></span>
<span id="cb697-46"><a href="em.html#cb697-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute responsibilities</span></span>
<span id="cb697-47"><a href="em.html#cb697-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>clusters){</span>
<span id="cb697-48"><a href="em.html#cb697-48" aria-hidden="true" tabindex="-1"></a>      ri[,k] <span class="ot">=</span> probs[k] <span class="sc">*</span> <span class="fu">dmvnorm</span>(X, mu[k, ], <span class="at">sigma =</span> var[[k]], <span class="at">log =</span> <span class="cn">FALSE</span>)</span>
<span id="cb697-49"><a href="em.html#cb697-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb697-50"><a href="em.html#cb697-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-51"><a href="em.html#cb697-51" aria-hidden="true" tabindex="-1"></a>    ri <span class="ot">=</span> ri<span class="sc">/</span><span class="fu">rowSums</span>(ri)</span>
<span id="cb697-52"><a href="em.html#cb697-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-53"><a href="em.html#cb697-53" aria-hidden="true" tabindex="-1"></a>    <span class="do">### M</span></span>
<span id="cb697-54"><a href="em.html#cb697-54" aria-hidden="true" tabindex="-1"></a>    rk <span class="ot">=</span> <span class="fu">colSums</span>(ri)            <span class="co"># rk is weighted average cluster membership size</span></span>
<span id="cb697-55"><a href="em.html#cb697-55" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">=</span> rk<span class="sc">/</span>N</span>
<span id="cb697-56"><a href="em.html#cb697-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-57"><a href="em.html#cb697-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>clusters){</span>
<span id="cb697-58"><a href="em.html#cb697-58" aria-hidden="true" tabindex="-1"></a>      varmat <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol =</span> <span class="fu">ncol</span>(X), <span class="at">nrow =</span> <span class="fu">ncol</span>(X))    <span class="co"># initialize to sum matrices</span></span>
<span id="cb697-59"><a href="em.html#cb697-59" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb697-60"><a href="em.html#cb697-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb697-61"><a href="em.html#cb697-61" aria-hidden="true" tabindex="-1"></a>        varmat <span class="ot">=</span> varmat <span class="sc">+</span> ri[i,k] <span class="sc">*</span> X[i,]<span class="sc">%*%</span><span class="fu">t</span>(X[i,])</span>
<span id="cb697-62"><a href="em.html#cb697-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb697-63"><a href="em.html#cb697-63" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb697-64"><a href="em.html#cb697-64" aria-hidden="true" tabindex="-1"></a>      mu[k,]   <span class="ot">=</span> (<span class="fu">t</span>(X) <span class="sc">%*%</span> ri[,k]) <span class="sc">/</span> rk[k]</span>
<span id="cb697-65"><a href="em.html#cb697-65" aria-hidden="true" tabindex="-1"></a>      var[[k]] <span class="ot">=</span>  varmat<span class="sc">/</span>rk[k] <span class="sc">-</span> mu[k,]<span class="sc">%*%</span><span class="fu">t</span>(mu[k,])</span>
<span id="cb697-66"><a href="em.html#cb697-66" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb697-67"><a href="em.html#cb697-67" aria-hidden="true" tabindex="-1"></a>      ll[k] <span class="ot">=</span> <span class="sc">-</span>.<span class="dv">5</span><span class="sc">*</span><span class="fu">sum</span>( ri[,k] <span class="sc">*</span> <span class="fu">dmvnorm</span>(X, mu[k,], <span class="at">sigma =</span> var[[k]], <span class="at">log =</span> <span class="cn">TRUE</span>) )</span>
<span id="cb697-68"><a href="em.html#cb697-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb697-69"><a href="em.html#cb697-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-70"><a href="em.html#cb697-70" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">sum</span>(ll)</span>
<span id="cb697-71"><a href="em.html#cb697-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-72"><a href="em.html#cb697-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compare old to current for convergence</span></span>
<span id="cb697-73"><a href="em.html#cb697-73" aria-hidden="true" tabindex="-1"></a>    parmlistold <span class="ot">=</span>  <span class="fu">c</span>(llOld, probsOld)           <span class="co"># c(muOld, unlist(varOld), probsOld)</span></span>
<span id="cb697-74"><a href="em.html#cb697-74" aria-hidden="true" tabindex="-1"></a>    parmlistcurrent <span class="ot">=</span> <span class="fu">c</span>(ll, probs)              <span class="co"># c(mu, unlist(var), probs)</span></span>
<span id="cb697-75"><a href="em.html#cb697-75" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb697-76"><a href="em.html#cb697-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-77"><a href="em.html#cb697-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if showits true, &amp; it =1 or modulo of 5 print message</span></span>
<span id="cb697-78"><a href="em.html#cb697-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>)         </span>
<span id="cb697-79"><a href="em.html#cb697-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb697-80"><a href="em.html#cb697-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb697-81"><a href="em.html#cb697-81" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">abs</span>(parmlistold <span class="sc">-</span> parmlistcurrent)) <span class="sc">&lt;=</span> tol</span>
<span id="cb697-82"><a href="em.html#cb697-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb697-83"><a href="em.html#cb697-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-84"><a href="em.html#cb697-84" aria-hidden="true" tabindex="-1"></a>  clust <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">round</span>(ri) <span class="sc">==</span> <span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)        <span class="co"># create cluster membership</span></span>
<span id="cb697-85"><a href="em.html#cb697-85" aria-hidden="true" tabindex="-1"></a>  clust <span class="ot">=</span> clust[<span class="fu">order</span>(clust[,<span class="dv">1</span>]), <span class="dv">2</span>]            <span class="co"># order accoring to row rather than cluster</span></span>
<span id="cb697-86"><a href="em.html#cb697-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-87"><a href="em.html#cb697-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb697-88"><a href="em.html#cb697-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb697-89"><a href="em.html#cb697-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs   =</span> probs,</span>
<span id="cb697-90"><a href="em.html#cb697-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu      =</span> mu,</span>
<span id="cb697-91"><a href="em.html#cb697-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">var     =</span> var,</span>
<span id="cb697-92"><a href="em.html#cb697-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">resp    =</span> ri,</span>
<span id="cb697-93"><a href="em.html#cb697-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster =</span> clust,</span>
<span id="cb697-94"><a href="em.html#cb697-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">ll      =</span> ll</span>
<span id="cb697-95"><a href="em.html#cb697-95" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb697-96"><a href="em.html#cb697-96" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
</div>
<div id="example-1-old-faithful" class="section level3">
<h3>Example 1: Old Faithful</h3>
<p>This example uses Old Faithful geyser eruptions as before. This is can be compared to the univariate code from the <a href="em.html#mixture-model">other chapter</a>. See also <a href="http://www.geyserstudy.org/geyser.aspx?pGeyserNo=OLDFAITHFUL" class="uri">http://www.geyserstudy.org/geyser.aspx?pGeyserNo=OLDFAITHFUL</a></p>
<div id="data-setup-41" class="section level4">
<h4>Data Setup</h4>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="em.html#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb698-2"><a href="em.html#cb698-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb698-3"><a href="em.html#cb698-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;faithful&quot;</span>)</span></code></pre></div>
</div>
<div id="estimation-39" class="section level4">
<h4>Estimation</h4>
<p>Create starting values and estimate.</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="em.html#cb699-1" aria-hidden="true" tabindex="-1"></a>mustart  <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">60</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="fl">60.1</span>))    <span class="co"># must be at least slightly different</span></span>
<span id="cb699-2"><a href="em.html#cb699-2" aria-hidden="true" tabindex="-1"></a>covstart <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">cov</span>(faithful), <span class="fu">cov</span>(faithful))</span>
<span id="cb699-3"><a href="em.html#cb699-3" aria-hidden="true" tabindex="-1"></a>probs    <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">99</span>)</span>
<span id="cb699-4"><a href="em.html#cb699-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb699-5"><a href="em.html#cb699-5" aria-hidden="true" tabindex="-1"></a><span class="co"># params is a list of mu, var, and probs </span></span>
<span id="cb699-6"><a href="em.html#cb699-6" aria-hidden="true" tabindex="-1"></a>starts <span class="ot">=</span> <span class="fu">list</span>(<span class="at">mu =</span> mustart, <span class="at">var =</span> covstart, <span class="at">probs =</span> probs)  </span></code></pre></div>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="em.html#cb700-1" aria-hidden="true" tabindex="-1"></a>mix_faithful <span class="ot">=</span> <span class="fu">em_mixture</span>(</span>
<span id="cb700-2"><a href="em.html#cb700-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> starts,</span>
<span id="cb700-3"><a href="em.html#cb700-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="fu">as.matrix</span>(faithful),</span>
<span id="cb700-4"><a href="em.html#cb700-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="dv">2</span>,</span>
<span id="cb700-5"><a href="em.html#cb700-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol      =</span> <span class="fl">1e-12</span>,</span>
<span id="cb700-6"><a href="em.html#cb700-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits   =</span> <span class="dv">1500</span>,</span>
<span id="cb700-7"><a href="em.html#cb700-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits  =</span> <span class="cn">TRUE</span></span>
<span id="cb700-8"><a href="em.html#cb700-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...
10...
15...
20...
25...
30...
35...
40...
45...
50...
55...
60...
65...
70...
75...
80...</code></pre>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="em.html#cb702-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mix_faithful)</span></code></pre></div>
<pre><code>List of 6
 $ probs  : num [1:2] 0.356 0.644
 $ mu     : num [1:2, 1:2] 2.04 4.29 54.48 79.97
 $ var    :List of 2
  ..$ : num [1:2, 1:2] 0.0692 0.4352 0.4352 33.6973
  .. ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] &quot;eruptions&quot; &quot;waiting&quot;
  ..$ : num [1:2, 1:2] 0.17 0.941 0.941 36.046
  .. ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. .. ..$ : NULL
  .. .. ..$ : chr [1:2] &quot;eruptions&quot; &quot;waiting&quot;
 $ resp   : num [1:272, 1:2] 2.59e-09 1.00 8.42e-06 1.00 1.00e-21 ...
 $ cluster: int [1:272] 2 1 2 1 2 1 2 2 1 2 ...
 $ ll     : num 477</code></pre>
<p>Visualize.</p>
<p><img src="model-demos_files/figure-html/mixmv-vis1-1.svg" width="75%" style="display: block; margin: auto;" /><img src="model-demos_files/figure-html/mixmv-vis1-2.svg" width="75%" style="display: block; margin: auto;" /><img src="model-demos_files/figure-html/mixmv-vis1-3.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="comparison-46" class="section level4">
<h4>Comparison</h4>
<p>Compare to <span class="pack" style="">mclust</span> results. Options are set to be more similar to the settings demonstrated.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="em.html#cb704-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb704-2"><a href="em.html#cb704-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-3"><a href="em.html#cb704-3" aria-hidden="true" tabindex="-1"></a>mix_mclust <span class="ot">=</span> mclust<span class="sc">::</span><span class="fu">Mclust</span>(</span>
<span id="cb704-4"><a href="em.html#cb704-4" aria-hidden="true" tabindex="-1"></a>  faithful[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],</span>
<span id="cb704-5"><a href="em.html#cb704-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>,</span>
<span id="cb704-6"><a href="em.html#cb704-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">modelNames =</span> <span class="st">&#39;VVV&#39;</span>,</span>
<span id="cb704-7"><a href="em.html#cb704-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">emControl</span>(<span class="at">tol =</span> <span class="fl">1e-12</span>)</span>
<span id="cb704-8"><a href="em.html#cb704-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb704-9"><a href="em.html#cb704-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-10"><a href="em.html#cb704-10" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>mclust)</span>
<span id="cb704-11"><a href="em.html#cb704-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-12"><a href="em.html#cb704-12" aria-hidden="true" tabindex="-1"></a><span class="co"># str(mix_mclust, 1)</span></span></code></pre></div>
<p>Compare means.</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="em.html#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(mix_faithful<span class="sc">$</span>mu)</span></code></pre></div>
<pre><code>          [,1]      [,2]
[1,]  2.036388  4.289662
[2,] 54.478516 79.968115</code></pre>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="em.html#cb707-1" aria-hidden="true" tabindex="-1"></a>mix_mclust<span class="sc">$</span>parameters<span class="sc">$</span>mean</span></code></pre></div>
<pre><code>               [,1]      [,2]
eruptions  4.289662  2.036388
waiting   79.968115 54.478517</code></pre>
<p>Compare variances.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="em.html#cb709-1" aria-hidden="true" tabindex="-1"></a>mix_faithful<span class="sc">$</span>var</span></code></pre></div>
<pre><code>[[1]]
      eruptions    waiting
[1,] 0.06916767  0.4351676
[2,] 0.43516762 33.6972821

[[2]]
     eruptions    waiting
[1,] 0.1699684  0.9406093
[2,] 0.9406093 36.0462113</code></pre>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="em.html#cb711-1" aria-hidden="true" tabindex="-1"></a>mix_mclust<span class="sc">$</span>parameters<span class="sc">$</span>variance<span class="sc">$</span>sigma</span></code></pre></div>
<pre><code>, , 1

          eruptions    waiting
eruptions 0.1699684  0.9406089
waiting   0.9406089 36.0462071

, , 2

           eruptions    waiting
eruptions 0.06916769  0.4351678
waiting   0.43516784 33.6972835</code></pre>
<p>Compare classifications. Reverse in case arbitrary labeling of one of the clusters is opposite.</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="em.html#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mix_faithful<span class="sc">$</span>cluster, mix_mclust<span class="sc">$</span>classification)</span></code></pre></div>
<pre><code>   
      1   2
  1   0  97
  2 175   0</code></pre>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="em.html#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">ifelse</span>(mix_faithful<span class="sc">$</span>cluster <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb715-2"><a href="em.html#cb715-2" aria-hidden="true" tabindex="-1"></a>      mix_mclust<span class="sc">$</span>classification)</span></code></pre></div>
<pre><code>   
      1   2
  1 175   0
  2   0  97</code></pre>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="em.html#cb717-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare responsibilities; reverse one if arbitrary numbering of one of them is opposite</span></span>
<span id="cb717-2"><a href="em.html#cb717-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind(round(mix_faithful$resp[,1], 2), round(mix_mclust$z[,2], 2)) # cluster &#39;1&#39;</span></span>
<span id="cb717-3"><a href="em.html#cb717-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind(round(mix_faithful$resp[,2], 2), round(mix_mclust$z[,1], 2)) # cluster &#39;2&#39;</span></span></code></pre></div>
</div>
</div>
<div id="example-2-iris" class="section level3">
<h3>Example 2: Iris</h3>
<div id="data-setup-42" class="section level4">
<h4>Data Setup</h4>
<p>Set up the data.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="em.html#cb718-1" aria-hidden="true" tabindex="-1"></a>iris2 <span class="ot">=</span> iris <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Species)</span></code></pre></div>
</div>
<div id="estimation-40" class="section level4">
<h4>Estimation</h4>
<p>Run and examine. We add noise to our starting value, and the function is notably sensitive to starts, but we don’t want to cheat too badly.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="em.html#cb719-1" aria-hidden="true" tabindex="-1"></a>mustart <span class="ot">=</span> iris <span class="sc">%&gt;%</span> </span>
<span id="cb719-2"><a href="em.html#cb719-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb719-3"><a href="em.html#cb719-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x) <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, .<span class="dv">5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb719-4"><a href="em.html#cb719-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb719-5"><a href="em.html#cb719-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb719-6"><a href="em.html#cb719-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-7"><a href="em.html#cb719-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-8"><a href="em.html#cb719-8" aria-hidden="true" tabindex="-1"></a><span class="co"># use purrr::map due to mclust::map masking</span></span>
<span id="cb719-9"><a href="em.html#cb719-9" aria-hidden="true" tabindex="-1"></a>covstart <span class="ot">=</span> iris <span class="sc">%&gt;%</span> </span>
<span id="cb719-10"><a href="em.html#cb719-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb719-11"><a href="em.html#cb719-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(select, <span class="sc">-</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb719-12"><a href="em.html#cb719-12" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x) <span class="fu">cov</span>(x) <span class="sc">+</span> <span class="fu">diag</span>(<span class="fu">runif</span>(<span class="dv">4</span>, <span class="dv">0</span>, .<span class="dv">5</span>))) </span>
<span id="cb719-13"><a href="em.html#cb719-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-14"><a href="em.html#cb719-14" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">=</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">2</span>, .<span class="dv">7</span>)</span>
<span id="cb719-15"><a href="em.html#cb719-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-16"><a href="em.html#cb719-16" aria-hidden="true" tabindex="-1"></a>starts <span class="ot">=</span> <span class="fu">list</span>(<span class="at">mu =</span> mustart, <span class="at">var =</span> covstart, <span class="at">probs =</span> probs)</span></code></pre></div>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="em.html#cb720-1" aria-hidden="true" tabindex="-1"></a>mix_mclust_iris <span class="ot">=</span> <span class="fu">em_mixture</span>(</span>
<span id="cb720-2"><a href="em.html#cb720-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> starts,</span>
<span id="cb720-3"><a href="em.html#cb720-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="fu">as.matrix</span>(iris2),</span>
<span id="cb720-4"><a href="em.html#cb720-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusters =</span> <span class="dv">3</span>,</span>
<span id="cb720-5"><a href="em.html#cb720-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol      =</span> <span class="fl">1e-8</span>,</span>
<span id="cb720-6"><a href="em.html#cb720-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits   =</span> <span class="dv">1500</span>,</span>
<span id="cb720-7"><a href="em.html#cb720-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits  =</span> T</span>
<span id="cb720-8"><a href="em.html#cb720-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...</code></pre>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="em.html#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mix_mclust_iris<span class="sc">$</span>cluster, iris<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>   
    setosa versicolor virginica
  1     50          0         0
  2      0         50         7
  3      0          0        43</code></pre>
</div>
<div id="comparison-47" class="section level4">
<h4>Comparison</h4>
<p>Compare to <span class="pack" style="">mclust</span> results.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="em.html#cb724-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb724-2"><a href="em.html#cb724-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-3"><a href="em.html#cb724-3" aria-hidden="true" tabindex="-1"></a>mclust_iris <span class="ot">=</span> mclust<span class="sc">::</span><span class="fu">Mclust</span>(iris[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">3</span>)</span>
<span id="cb724-4"><a href="em.html#cb724-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mclust_iris<span class="sc">$</span>classification, iris<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>   
    setosa versicolor virginica
  1     50          0         0
  2      0         45         0
  3      0          5        50</code></pre>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="em.html#cb726-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>mclust)</span></code></pre></div>
</div>
</div>
<div id="source-44" class="section level3">
<h3>Source</h3>
<p>Original code available at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20Mixture%20MV.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20Mixture%20MV.R</a></p>
</div>
</div>
<div id="probit-model" class="section level2">
<h2>Probit Model</h2>
<p>The following regards models for a binary response. See Murphy, 2012 Probabilistic Machine Learning Chapter 11.4.</p>
<div id="data-setup-43" class="section level3">
<h3>Data Setup</h3>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="em.html#cb727-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb727-2"><a href="em.html#cb727-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb727-3"><a href="em.html#cb727-3" aria-hidden="true" tabindex="-1"></a>admission <span class="ot">=</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">&quot;https://stats.idre.ucla.edu/stat/stata/dae/binary.dta&quot;</span>)</span></code></pre></div>
</div>
<div id="probit-via-maximum-likelihood" class="section level3">
<h3>Probit via Maximum Likelihood</h3>
<div id="function-25" class="section level4">
<h4>Function</h4>
<p>We’ll start with the a basic maximum likelihood function for a standard probit. See the <a href="supplemental.html#python-logreg">logistic regression</a> and <a href="probit.html#probit-bivariate-probit">previous chapter on probit models</a> for comparison.</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="em.html#cb728-1" aria-hidden="true" tabindex="-1"></a>probit_mle <span class="ot">&lt;-</span> <span class="cf">function</span>(params, X, y){</span>
<span id="cb728-2"><a href="em.html#cb728-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments are starting parameters (coefficients), model matrix, response </span></span>
<span id="cb728-3"><a href="em.html#cb728-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb728-4"><a href="em.html#cb728-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">=</span> params</span>
<span id="cb728-5"><a href="em.html#cb728-5" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> X <span class="sc">%*%</span> b    <span class="co"># linear predictor</span></span>
<span id="cb728-6"><a href="em.html#cb728-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb728-7"><a href="em.html#cb728-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the log likelihood either way</span></span>
<span id="cb728-8"><a href="em.html#cb728-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ll = sum(y * pnorm(mu, log.p = TRUE) + (1 - y) * pnorm(-mu, log.p = TRUE))  </span></span>
<span id="cb728-9"><a href="em.html#cb728-9" aria-hidden="true" tabindex="-1"></a>  ll <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">dbinom</span>(y, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">pnorm</span>(mu), <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb728-10"><a href="em.html#cb728-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb728-11"><a href="em.html#cb728-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>ll</span>
<span id="cb728-12"><a href="em.html#cb728-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimation-41" class="section level4">
<h4>Estimation</h4>
<p>Estimate with <span class="func" style="">optim</span>.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="em.html#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input data</span></span>
<span id="cb729-2"><a href="em.html#cb729-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, admission[, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]))</span>
<span id="cb729-3"><a href="em.html#cb729-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">as.matrix</span>(admission[, <span class="dv">1</span>])</span>
<span id="cb729-4"><a href="em.html#cb729-4" aria-hidden="true" tabindex="-1"></a>init <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb729-5"><a href="em.html#cb729-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-6"><a href="em.html#cb729-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Can set tolerance really low to duplicate glm result</span></span>
<span id="cb729-7"><a href="em.html#cb729-7" aria-hidden="true" tabindex="-1"></a>fit_mle <span class="ot">=</span> <span class="fu">optim</span>(</span>
<span id="cb729-8"><a href="em.html#cb729-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">par =</span> init,</span>
<span id="cb729-9"><a href="em.html#cb729-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn  =</span> probit_mle,</span>
<span id="cb729-10"><a href="em.html#cb729-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">X   =</span> X,</span>
<span id="cb729-11"><a href="em.html#cb729-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">y   =</span> y,</span>
<span id="cb729-12"><a href="em.html#cb729-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">1000</span>, <span class="at">reltol =</span> <span class="fl">1e-12</span>)</span>
<span id="cb729-13"><a href="em.html#cb729-13" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb729-14"><a href="em.html#cb729-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb729-15"><a href="em.html#cb729-15" aria-hidden="true" tabindex="-1"></a><span class="co"># extract coefficients</span></span>
<span id="cb729-16"><a href="em.html#cb729-16" aria-hidden="true" tabindex="-1"></a>coefs_mle <span class="ot">=</span> fit_mle<span class="sc">$</span>par</span></code></pre></div>
</div>
<div id="comparison-48" class="section level4">
<h4>Comparison</h4>
<p>Compare to <span class="func" style="">glm</span>.</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="em.html#cb730-1" aria-hidden="true" tabindex="-1"></a>fit_glm <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb730-2"><a href="em.html#cb730-2" aria-hidden="true" tabindex="-1"></a>  admit <span class="sc">~</span> gre <span class="sc">+</span> gpa <span class="sc">+</span> rank,</span>
<span id="cb730-3"><a href="em.html#cb730-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family  =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>),</span>
<span id="cb730-4"><a href="em.html#cb730-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">500</span>, <span class="at">epsilon =</span> <span class="fl">1e-8</span>),</span>
<span id="cb730-5"><a href="em.html#cb730-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data    =</span> admission</span>
<span id="cb730-6"><a href="em.html#cb730-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb730-7"><a href="em.html#cb730-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-8"><a href="em.html#cb730-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-9"><a href="em.html#cb730-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_glm)</span></code></pre></div>
<pre><code>
Call:
glm(formula = admit ~ gre + gpa + rank, family = binomial(link = &quot;probit&quot;), 
    data = admission, control = list(maxit = 500, epsilon = 1e-08))

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5626  -0.8920  -0.6403   1.1631   2.2097  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.0915039  0.6718360  -3.113  0.00185 ** 
gre          0.0013982  0.0006487   2.156  0.03112 *  
gpa          0.4643599  0.1950263   2.381  0.01727 *  
rank        -0.3317117  0.0745524  -4.449 8.61e-06 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 499.98  on 399  degrees of freedom
Residual deviance: 459.48  on 396  degrees of freedom
AIC: 467.48

Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="em.html#cb732-1" aria-hidden="true" tabindex="-1"></a>coefs_glm <span class="ot">=</span> <span class="fu">coef</span>(fit_glm)</span></code></pre></div>
<p>Compare.</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
(Intercept)
</th>
<th style="text-align:right;">
gre
</th>
<th style="text-align:right;">
gpa
</th>
<th style="text-align:right;">
rank
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
coefs_mle
</td>
<td style="text-align:right;">
-2.092
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
-0.332
</td>
</tr>
<tr>
<td style="text-align:left;">
coefs_glm
</td>
<td style="text-align:right;">
-2.092
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
-0.332
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="em-for-latent-variable-approach-to-probit" class="section level3">
<h3>EM for Latent Variable Approach to Probit</h3>
<p>Now for the EM approach, which assumes an continuous latent variable underlying the binary target.</p>
<div id="function-26" class="section level4">
<h4>Function</h4>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="em.html#cb733-1" aria-hidden="true" tabindex="-1"></a>em_probit <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb733-2"><a href="em.html#cb733-2" aria-hidden="true" tabindex="-1"></a>  params,</span>
<span id="cb733-3"><a href="em.html#cb733-3" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb733-4"><a href="em.html#cb733-4" aria-hidden="true" tabindex="-1"></a>  y,</span>
<span id="cb733-5"><a href="em.html#cb733-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol =</span> .<span class="dv">00001</span>,</span>
<span id="cb733-6"><a href="em.html#cb733-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits  =</span> <span class="dv">100</span>,</span>
<span id="cb733-7"><a href="em.html#cb733-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits =</span> <span class="cn">TRUE</span></span>
<span id="cb733-8"><a href="em.html#cb733-8" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb733-9"><a href="em.html#cb733-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb733-10"><a href="em.html#cb733-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments </span></span>
<span id="cb733-11"><a href="em.html#cb733-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># params: starting parameters (coefficients)</span></span>
<span id="cb733-12"><a href="em.html#cb733-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X: model matrix</span></span>
<span id="cb733-13"><a href="em.html#cb733-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y: response </span></span>
<span id="cb733-14"><a href="em.html#cb733-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tol: tolerance, </span></span>
<span id="cb733-15"><a href="em.html#cb733-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># maxits: maximum iterations</span></span>
<span id="cb733-16"><a href="em.html#cb733-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># showits: whether to show iterations</span></span>
<span id="cb733-17"><a href="em.html#cb733-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb733-18"><a href="em.html#cb733-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#starting points</span></span>
<span id="cb733-19"><a href="em.html#cb733-19" aria-hidden="true" tabindex="-1"></a>  b  <span class="ot">=</span> params</span>
<span id="cb733-20"><a href="em.html#cb733-20" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> X<span class="sc">%*%</span>b</span>
<span id="cb733-21"><a href="em.html#cb733-21" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb733-22"><a href="em.html#cb733-22" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb733-23"><a href="em.html#cb733-23" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(y))    <span class="co"># z is the latent variable ~N(0,1)</span></span>
<span id="cb733-24"><a href="em.html#cb733-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb733-25"><a href="em.html#cb733-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show iterations</span></span>
<span id="cb733-26"><a href="em.html#cb733-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                                            </span>
<span id="cb733-27"><a href="em.html#cb733-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb733-28"><a href="em.html#cb733-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb733-29"><a href="em.html#cb733-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># while no convergence and we haven&#39;t reached our max iterations do this stuff</span></span>
<span id="cb733-30"><a href="em.html#cb733-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> ((<span class="sc">!</span>converged) <span class="sc">&amp;</span> (it <span class="sc">&lt;</span> maxits)) {                                 </span>
<span id="cb733-31"><a href="em.html#cb733-31" aria-hidden="true" tabindex="-1"></a>    z_old <span class="ot">=</span> z       <span class="co"># create &#39;old&#39; values for comparison</span></span>
<span id="cb733-32"><a href="em.html#cb733-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb733-33"><a href="em.html#cb733-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># E step create a new z based on current values</span></span>
<span id="cb733-34"><a href="em.html#cb733-34" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb733-35"><a href="em.html#cb733-35" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb733-36"><a href="em.html#cb733-36" aria-hidden="true" tabindex="-1"></a>      mu <span class="sc">+</span> <span class="fu">dnorm</span>(mu) <span class="sc">/</span> <span class="fu">pnorm</span>(mu), </span>
<span id="cb733-37"><a href="em.html#cb733-37" aria-hidden="true" tabindex="-1"></a>      mu <span class="sc">-</span> <span class="fu">dnorm</span>(mu) <span class="sc">/</span> <span class="fu">pnorm</span>(<span class="sc">-</span>mu)</span>
<span id="cb733-38"><a href="em.html#cb733-38" aria-hidden="true" tabindex="-1"></a>    )     </span>
<span id="cb733-39"><a href="em.html#cb733-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb733-40"><a href="em.html#cb733-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M step estimate b</span></span>
<span id="cb733-41"><a href="em.html#cb733-41" aria-hidden="true" tabindex="-1"></a>    b  <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X) <span class="sc">%*%</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>z                                     </span>
<span id="cb733-42"><a href="em.html#cb733-42" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> X<span class="sc">%*%</span>b</span>
<span id="cb733-43"><a href="em.html#cb733-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb733-44"><a href="em.html#cb733-44" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">sum</span>(y <span class="sc">*</span> <span class="fu">pnorm</span>(mu, <span class="at">log.p =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> y) <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="sc">-</span>mu, <span class="at">log.p =</span> <span class="cn">TRUE</span>))</span>
<span id="cb733-45"><a href="em.html#cb733-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb733-46"><a href="em.html#cb733-46" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb733-47"><a href="em.html#cb733-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb733-48"><a href="em.html#cb733-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> (it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb733-49"><a href="em.html#cb733-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb733-50"><a href="em.html#cb733-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb733-51"><a href="em.html#cb733-51" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(z_old <span class="sc">-</span> z)) <span class="sc">&lt;=</span> tol</span>
<span id="cb733-52"><a href="em.html#cb733-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb733-53"><a href="em.html#cb733-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb733-54"><a href="em.html#cb733-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show last iteration</span></span>
<span id="cb733-55"><a href="em.html#cb733-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                                            </span>
<span id="cb733-56"><a href="em.html#cb733-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb733-57"><a href="em.html#cb733-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb733-58"><a href="em.html#cb733-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">b =</span> <span class="fu">t</span>(b), <span class="at">ll =</span> ll)</span>
<span id="cb733-59"><a href="em.html#cb733-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimation-42" class="section level4">
<h4>Estimation</h4>
<p>Use the same setup and starting values to estimate the parameters.</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb734-1"><a href="em.html#cb734-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can lower tolerance to duplicate glm result</span></span>
<span id="cb734-2"><a href="em.html#cb734-2" aria-hidden="true" tabindex="-1"></a>fit_em <span class="ot">=</span> <span class="fu">em_probit</span>(</span>
<span id="cb734-3"><a href="em.html#cb734-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> init,</span>
<span id="cb734-4"><a href="em.html#cb734-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X      =</span> X,</span>
<span id="cb734-5"><a href="em.html#cb734-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y      =</span> y,</span>
<span id="cb734-6"><a href="em.html#cb734-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol    =</span> <span class="fl">1e-12</span>,</span>
<span id="cb734-7"><a href="em.html#cb734-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxit  =</span> <span class="dv">100</span></span>
<span id="cb734-8"><a href="em.html#cb734-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...
10...
15...
20...
25...
30...
35...
40...
45...
50...
51...</code></pre>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="em.html#cb736-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit_em  </span></span>
<span id="cb736-2"><a href="em.html#cb736-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb736-3"><a href="em.html#cb736-3" aria-hidden="true" tabindex="-1"></a>coefs_em <span class="ot">=</span> fit_em<span class="sc">$</span>b</span></code></pre></div>
</div>
<div id="comparison-49" class="section level4">
<h4>Comparison</h4>
<p>Compare all results.</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
fit
</th>
<th style="text-align:right;">
(Intercept)
</th>
<th style="text-align:right;">
gre
</th>
<th style="text-align:right;">
gpa
</th>
<th style="text-align:right;">
rank
</th>
<th style="text-align:right;">
logLik
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
glm
</td>
<td style="text-align:right;">
-2.092
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
-0.332
</td>
<td style="text-align:right;">
-229.74
</td>
</tr>
<tr>
<td style="text-align:left;">
mle
</td>
<td style="text-align:right;">
-2.092
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
-0.332
</td>
<td style="text-align:right;">
229.74
</td>
</tr>
<tr>
<td style="text-align:left;">
em
</td>
<td style="text-align:right;">
-2.092
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.464
</td>
<td style="text-align:right;">
-0.332
</td>
<td style="text-align:right;">
-229.74
</td>
</tr>
</tbody>
</table>
</div>
<div id="visualize-3" class="section level4">
<h4>Visualize</h4>
<p>Show estimates over niter iterations and visualize.</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="em.html#cb737-1" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> X</span>
<span id="cb737-2"><a href="em.html#cb737-2" aria-hidden="true" tabindex="-1"></a>X2[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">=</span> <span class="fu">scale</span>(X2[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb737-3"><a href="em.html#cb737-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb737-4"><a href="em.html#cb737-4" aria-hidden="true" tabindex="-1"></a>niter <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb737-5"><a href="em.html#cb737-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb737-6"><a href="em.html#cb737-6" aria-hidden="true" tabindex="-1"></a>fit_em <span class="ot">=</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span>niter, <span class="cf">function</span>(x)</span>
<span id="cb737-7"><a href="em.html#cb737-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(</span>
<span id="cb737-8"><a href="em.html#cb737-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">em_probit</span>(</span>
<span id="cb737-9"><a href="em.html#cb737-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">params  =</span> init,</span>
<span id="cb737-10"><a href="em.html#cb737-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">X       =</span> X2,</span>
<span id="cb737-11"><a href="em.html#cb737-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">y       =</span> y,</span>
<span id="cb737-12"><a href="em.html#cb737-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">tol     =</span> <span class="fl">1e-8</span>,</span>
<span id="cb737-13"><a href="em.html#cb737-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">maxit   =</span> x,</span>
<span id="cb737-14"><a href="em.html#cb737-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">showits =</span> F</span>
<span id="cb737-15"><a href="em.html#cb737-15" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">$</span>b)</span>
<span id="cb737-16"><a href="em.html#cb737-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb737-17"><a href="em.html#cb737-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb737-18"><a href="em.html#cb737-18" aria-hidden="true" tabindex="-1"></a>gdat <span class="ot">=</span> fit_em <span class="sc">%&gt;%</span> </span>
<span id="cb737-19"><a href="em.html#cb737-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="st">&#39;iter&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb737-20"><a href="em.html#cb737-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&#39;coef&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb737-21"><a href="em.html#cb737-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb737-22"><a href="em.html#cb737-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">coef =</span> <span class="fu">factor</span>(coef, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;Intercept&#39;</span>, <span class="st">&#39;gre&#39;</span>, <span class="st">&#39;gpa&#39;</span>, <span class="st">&#39;rank&#39;</span>))</span>
<span id="cb737-23"><a href="em.html#cb737-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb737-24"><a href="em.html#cb737-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(iter, coef)</span></code></pre></div>
<p><img src="model-demos_files/figure-html/probit-em-vis-show-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="source-45" class="section level3">
<h3>Source</h3>
<p>Original code available at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20algorithm%20for%20probit%20example.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20algorithm%20for%20probit%20example.R</a></p>
</div>
</div>
<div id="pca" class="section level2">
<h2>PCA</h2>
<p>The following is an EM algorithm for principal components analysis. See Murphy,
2012 Probabilistic Machine Learning 12.2.5. Some of the constructed object is
based on output from <span class="func" style="">pca</span> function used below.</p>
<div id="data-setup-44" class="section level3">
<h3>Data Setup</h3>
<p>The <code>state.x77</code> is from base R, which includes various state demographics. We
will first standardize the data.</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="em.html#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb738-2"><a href="em.html#cb738-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-3"><a href="em.html#cb738-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(state.x77)</span></code></pre></div>
</div>
<div id="function-27" class="section level3">
<h3>Function</h3>
<p>The estimating function. Note that it uses <span class="func" style="">orth</span> from <span class="pack" style="">pracma</span>, but I show the
core of the underlying code if you don’t want to install it.</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="em.html#cb739-1" aria-hidden="true" tabindex="-1"></a><span class="co"># orth &lt;- function(M) {</span></span>
<span id="cb739-2"><a href="em.html#cb739-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   svdM = svd(M)</span></span>
<span id="cb739-3"><a href="em.html#cb739-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   U    = svdM$u</span></span>
<span id="cb739-4"><a href="em.html#cb739-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   s    = svdM$d</span></span>
<span id="cb739-5"><a href="em.html#cb739-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   tol  = max(dim(M)) * max(s) * .Machine$double.eps</span></span>
<span id="cb739-6"><a href="em.html#cb739-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   r    = sum(s &gt; tol)</span></span>
<span id="cb739-7"><a href="em.html#cb739-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb739-8"><a href="em.html#cb739-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   U[, 1:r, drop = FALSE]</span></span>
<span id="cb739-9"><a href="em.html#cb739-9" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb739-10"><a href="em.html#cb739-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-11"><a href="em.html#cb739-11" aria-hidden="true" tabindex="-1"></a>em_pca <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb739-12"><a href="em.html#cb739-12" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb739-13"><a href="em.html#cb739-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_comp   =</span> <span class="dv">2</span>,</span>
<span id="cb739-14"><a href="em.html#cb739-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol     =</span> .<span class="dv">00001</span>,</span>
<span id="cb739-15"><a href="em.html#cb739-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits  =</span> <span class="dv">100</span>,</span>
<span id="cb739-16"><a href="em.html#cb739-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits =</span> <span class="cn">TRUE</span></span>
<span id="cb739-17"><a href="em.html#cb739-17" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb739-18"><a href="em.html#cb739-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-19"><a href="em.html#cb739-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments </span></span>
<span id="cb739-20"><a href="em.html#cb739-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X: numeric data</span></span>
<span id="cb739-21"><a href="em.html#cb739-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_comp: number of components</span></span>
<span id="cb739-22"><a href="em.html#cb739-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tol = tolerance level</span></span>
<span id="cb739-23"><a href="em.html#cb739-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># maxits: maximum iterations</span></span>
<span id="cb739-24"><a href="em.html#cb739-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># showits: show iterations</span></span>
<span id="cb739-25"><a href="em.html#cb739-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-26"><a href="em.html#cb739-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-27"><a href="em.html#cb739-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># starting points and other initializations</span></span>
<span id="cb739-28"><a href="em.html#cb739-28" aria-hidden="true" tabindex="-1"></a>  N  <span class="ot">=</span> <span class="fu">nrow</span>(X)</span>
<span id="cb739-29"><a href="em.html#cb739-29" aria-hidden="true" tabindex="-1"></a>  D  <span class="ot">=</span> <span class="fu">ncol</span>(X)</span>
<span id="cb739-30"><a href="em.html#cb739-30" aria-hidden="true" tabindex="-1"></a>  L  <span class="ot">=</span> n_comp</span>
<span id="cb739-31"><a href="em.html#cb739-31" aria-hidden="true" tabindex="-1"></a>  Xt <span class="ot">=</span> <span class="fu">t</span>(X)</span>
<span id="cb739-32"><a href="em.html#cb739-32" aria-hidden="true" tabindex="-1"></a>  Z  <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">replicate</span>(L, <span class="fu">rnorm</span>(N)))                 <span class="co"># latent variables</span></span>
<span id="cb739-33"><a href="em.html#cb739-33" aria-hidden="true" tabindex="-1"></a>  W  <span class="ot">=</span> <span class="fu">replicate</span>(L, <span class="fu">rnorm</span>(D))                    <span class="co"># loadings</span></span>
<span id="cb739-34"><a href="em.html#cb739-34" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb739-35"><a href="em.html#cb739-35" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb739-36"><a href="em.html#cb739-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb739-37"><a href="em.html#cb739-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                                     </span>
<span id="cb739-38"><a href="em.html#cb739-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb739-39"><a href="em.html#cb739-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-40"><a href="em.html#cb739-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># while no convergence and we haven&#39;t reached our max iterations do this stuff</span></span>
<span id="cb739-41"><a href="em.html#cb739-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> ((<span class="sc">!</span>converged) <span class="sc">&amp;</span> (it <span class="sc">&lt;</span> maxits)) {                           </span>
<span id="cb739-42"><a href="em.html#cb739-42" aria-hidden="true" tabindex="-1"></a>    Z_old <span class="ot">=</span> Z                                    <span class="co"># create &#39;old&#39; values for comparison</span></span>
<span id="cb739-43"><a href="em.html#cb739-43" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(W)<span class="sc">%*%</span>W) <span class="sc">%*%</span> <span class="fu">crossprod</span>(W, Xt)     <span class="co"># E</span></span>
<span id="cb739-44"><a href="em.html#cb739-44" aria-hidden="true" tabindex="-1"></a>    W <span class="ot">=</span> Xt<span class="sc">%*%</span><span class="fu">t</span>(Z) <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">tcrossprod</span>(Z))       <span class="co"># M</span></span>
<span id="cb739-45"><a href="em.html#cb739-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-46"><a href="em.html#cb739-46" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb739-47"><a href="em.html#cb739-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb739-48"><a href="em.html#cb739-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if showits, show first and every 5th iteration</span></span>
<span id="cb739-49"><a href="em.html#cb739-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> (it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>))           </span>
<span id="cb739-50"><a href="em.html#cb739-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb739-51"><a href="em.html#cb739-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb739-52"><a href="em.html#cb739-52" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(Z_old<span class="sc">-</span>Z)) <span class="sc">&lt;=</span> tol</span>
<span id="cb739-53"><a href="em.html#cb739-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb739-54"><a href="em.html#cb739-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-55"><a href="em.html#cb739-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate reconstruction error</span></span>
<span id="cb739-56"><a href="em.html#cb739-56" aria-hidden="true" tabindex="-1"></a>  Xrecon_em <span class="ot">=</span> W <span class="sc">%*%</span> Z</span>
<span id="cb739-57"><a href="em.html#cb739-57" aria-hidden="true" tabindex="-1"></a>  reconerr  <span class="ot">=</span> <span class="fu">sum</span>((Xrecon_em <span class="sc">-</span> <span class="fu">t</span>(X))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb739-58"><a href="em.html#cb739-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-59"><a href="em.html#cb739-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># orthogonalize</span></span>
<span id="cb739-60"><a href="em.html#cb739-60" aria-hidden="true" tabindex="-1"></a>  W     <span class="ot">=</span> pracma<span class="sc">::</span><span class="fu">orth</span>(W)     <span class="co"># for orthonormal basis of W; pcaMethods package has also</span></span>
<span id="cb739-61"><a href="em.html#cb739-61" aria-hidden="true" tabindex="-1"></a>  evs   <span class="ot">=</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(X <span class="sc">%*%</span> W))</span>
<span id="cb739-62"><a href="em.html#cb739-62" aria-hidden="true" tabindex="-1"></a>  evals <span class="ot">=</span> evs<span class="sc">$</span>values</span>
<span id="cb739-63"><a href="em.html#cb739-63" aria-hidden="true" tabindex="-1"></a>  evecs <span class="ot">=</span> evs<span class="sc">$</span>vectors</span>
<span id="cb739-64"><a href="em.html#cb739-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-65"><a href="em.html#cb739-65" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">=</span> W <span class="sc">%*%</span> evecs</span>
<span id="cb739-66"><a href="em.html#cb739-66" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">=</span> X <span class="sc">%*%</span> W</span>
<span id="cb739-67"><a href="em.html#cb739-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb739-68"><a href="em.html#cb739-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                     <span class="co"># Show last iteration</span></span>
<span id="cb739-69"><a href="em.html#cb739-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb739-70"><a href="em.html#cb739-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb739-71"><a href="em.html#cb739-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb739-72"><a href="em.html#cb739-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">scores    =</span> Z,</span>
<span id="cb739-73"><a href="em.html#cb739-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">loadings  =</span> W,</span>
<span id="cb739-74"><a href="em.html#cb739-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">reconerr  =</span> reconerr,</span>
<span id="cb739-75"><a href="em.html#cb739-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">Xrecon_em =</span> <span class="fu">t</span>(Xrecon_em)</span>
<span id="cb739-76"><a href="em.html#cb739-76" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb739-77"><a href="em.html#cb739-77" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimation-43" class="section level3">
<h3>Estimation</h3>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="em.html#cb740-1" aria-hidden="true" tabindex="-1"></a>fit_em <span class="ot">=</span> <span class="fu">em_pca</span>(</span>
<span id="cb740-2"><a href="em.html#cb740-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb740-3"><a href="em.html#cb740-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_comp =</span> <span class="dv">2</span>,</span>
<span id="cb740-4"><a href="em.html#cb740-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol    =</span> <span class="fl">1e-12</span>,</span>
<span id="cb740-5"><a href="em.html#cb740-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxit  =</span> <span class="dv">1000</span></span>
<span id="cb740-6"><a href="em.html#cb740-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...
10...
15...
20...
25...
30...
35...
40...
45...
50...
55...
60...
65...
70...
74...</code></pre>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="em.html#cb742-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fit_em)  <span class="co"># examine results</span></span></code></pre></div>
<pre><code>List of 4
 $ scores   : num [1:50, 1:2] 3.79 -1.053 0.867 2.382 0.241 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
  .. ..$ : NULL
 $ loadings : num [1:8, 1:2] 0.126 -0.299 0.468 -0.412 0.444 ...
 $ reconerr : num 136
 $ Xrecon_em: num [1:50, 1:8] 0.383 2.109 0.416 -0.228 1.472 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
  .. ..$ : chr [1:8] &quot;Population&quot; &quot;Income&quot; &quot;Illiteracy&quot; &quot;Life Exp&quot; ...</code></pre>
</div>
<div id="comparison-50" class="section level3">
<h3>Comparison</h3>
<p>Extract reconstructed values and loadings for comparison.</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="em.html#cb744-1" aria-hidden="true" tabindex="-1"></a>Xrecon_em   <span class="ot">=</span> fit_em<span class="sc">$</span>Xrecon_em</span>
<span id="cb744-2"><a href="em.html#cb744-2" aria-hidden="true" tabindex="-1"></a>loadings_em <span class="ot">=</span> fit_em<span class="sc">$</span>loadings</span>
<span id="cb744-3"><a href="em.html#cb744-3" aria-hidden="true" tabindex="-1"></a>scores_em   <span class="ot">=</span> fit_em<span class="sc">$</span>scores</span></code></pre></div>
<p>Compare results to output from <span class="pack" style="">pcaMethods</span>, which also has probabilistic PCA (demonstrated next). Note that the signs for loadings/scores may be different in sign, but otherwise should be comparable.</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="em.html#cb745-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pcaMethods)  <span class="co"># install via BiocManager::install(&quot;pcaMethods&quot;)</span></span>
<span id="cb745-2"><a href="em.html#cb745-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-3"><a href="em.html#cb745-3" aria-hidden="true" tabindex="-1"></a>fit_pcam <span class="ot">=</span> <span class="fu">pca</span>(</span>
<span id="cb745-4"><a href="em.html#cb745-4" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb745-5"><a href="em.html#cb745-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nPcs =</span> <span class="dv">2</span>,</span>
<span id="cb745-6"><a href="em.html#cb745-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&#39;svd&#39;</span>,</span>
<span id="cb745-7"><a href="em.html#cb745-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale  =</span> <span class="st">&#39;none&#39;</span>,</span>
<span id="cb745-8"><a href="em.html#cb745-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb745-9"><a href="em.html#cb745-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb745-10"><a href="em.html#cb745-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb745-11"><a href="em.html#cb745-11" aria-hidden="true" tabindex="-1"></a>loadings_pcam <span class="ot">=</span> <span class="fu">loadings</span>(fit_pcam)</span>
<span id="cb745-12"><a href="em.html#cb745-12" aria-hidden="true" tabindex="-1"></a>scores_pcam   <span class="ot">=</span> <span class="fu">scores</span>(fit_pcam)</span></code></pre></div>
<p>Compare loadings and scores.</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="em.html#cb746-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((<span class="fu">abs</span>(loadings_pcam) <span class="sc">-</span> <span class="fu">abs</span>(loadings_em))<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 2.166071e-24</code></pre>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="em.html#cb748-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(scores_pcam, <span class="fu">data.frame</span>(<span class="at">EM =</span> scores_em)) <span class="sc">%&gt;%</span> </span>
<span id="cb748-2"><a href="em.html#cb748-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>                  PC1        PC2       EM.1       EM.2
Alabama     3.7898873 -0.2347790  3.7898873 -0.2347790
Alaska     -1.0531355  5.4561751 -1.0531355  5.4561751
Arizona     0.8674288  0.7450615  0.8674288  0.7450615
Arkansas    2.3817776 -1.2883437  2.3817776 -1.2883437
California  0.2413815  3.5095228  0.2413815  3.5095228
Colorado   -2.0621814  0.5056639 -2.0621814  0.5056639</code></pre>
<p>Calculate mean squared reconstruction error and compare.</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="em.html#cb750-1" aria-hidden="true" tabindex="-1"></a>Xrecon_pcam <span class="ot">=</span> scores_pcam <span class="sc">%*%</span> <span class="fu">t</span>(loadings_pcam)</span>
<span id="cb750-2"><a href="em.html#cb750-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb750-3"><a href="em.html#cb750-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Xrecon_em <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 0.3392252</code></pre>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="em.html#cb752-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Xrecon_pcam <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 0.3392252</code></pre>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="em.html#cb754-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(Xrecon_pcam <span class="sc">-</span> Xrecon_em))</span></code></pre></div>
<pre><code>[1] 6.109616e-13</code></pre>
</div>
<div id="visualize-4" class="section level3">
<h3>Visualize</h3>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="em.html#cb756-1" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(Xrecon_pcam[,1], X[,1])</span></span>
<span id="cb756-2"><a href="em.html#cb756-2" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(Xrecon_pcam[,2], X[,2])</span></span>
<span id="cb756-3"><a href="em.html#cb756-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(Xrecon_em[,<span class="dv">1</span>], Xrecon_pcam[,<span class="dv">1</span>])</span></code></pre></div>
<p><img src="model-demos_files/figure-html/em-pca-vis-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="source-46" class="section level3">
<h3>Source</h3>
<p>Original code available at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20for%20pca.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20for%20pca.R</a></p>
</div>
</div>
<div id="probabilistic-pca" class="section level2">
<h2>Probabilistic PCA</h2>
<p>The following is an EM algorithm for probabilistic principal components
analysis. Based on Tipping and Bishop, 1999, and also Murphy 2012 Probabilistic
ML, with some code snippets inspired by the <span class="func" style="">ppca</span> function used below. See also <a href="em.html#pca">standard PCA</a>.</p>
<div id="data-setup-45" class="section level3">
<h3>Data Setup</h3>
<p><code>state.x77</code> is from base R, which includes various state demographics. We will
first standardize the data.</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="em.html#cb757-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb757-2"><a href="em.html#cb757-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb757-3"><a href="em.html#cb757-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">scale</span>(state.x77)</span></code></pre></div>
</div>
<div id="function-28" class="section level3">
<h3>Function</h3>
<p>The estimating function. Note that it uses <span class="func" style="">orth</span> from <span class="pack" style="">pracma</span>, but I show the
core of the underlying code if you don’t want to install it.</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="em.html#cb758-1" aria-hidden="true" tabindex="-1"></a>orth <span class="ot">&lt;-</span> <span class="cf">function</span>(M) {</span>
<span id="cb758-2"><a href="em.html#cb758-2" aria-hidden="true" tabindex="-1"></a>  svdM <span class="ot">=</span> <span class="fu">svd</span>(M)</span>
<span id="cb758-3"><a href="em.html#cb758-3" aria-hidden="true" tabindex="-1"></a>  U    <span class="ot">=</span> svdM<span class="sc">$</span>u</span>
<span id="cb758-4"><a href="em.html#cb758-4" aria-hidden="true" tabindex="-1"></a>  s    <span class="ot">=</span> svdM<span class="sc">$</span>d</span>
<span id="cb758-5"><a href="em.html#cb758-5" aria-hidden="true" tabindex="-1"></a>  tol  <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">dim</span>(M)) <span class="sc">*</span> <span class="fu">max</span>(s) <span class="sc">*</span> .Machine<span class="sc">$</span>double.eps</span>
<span id="cb758-6"><a href="em.html#cb758-6" aria-hidden="true" tabindex="-1"></a>  r    <span class="ot">=</span> <span class="fu">sum</span>(s <span class="sc">&gt;</span> tol)</span>
<span id="cb758-7"><a href="em.html#cb758-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-8"><a href="em.html#cb758-8" aria-hidden="true" tabindex="-1"></a>  U[, <span class="dv">1</span><span class="sc">:</span>r, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb758-9"><a href="em.html#cb758-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb758-10"><a href="em.html#cb758-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-11"><a href="em.html#cb758-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-12"><a href="em.html#cb758-12" aria-hidden="true" tabindex="-1"></a>em_ppca <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb758-13"><a href="em.html#cb758-13" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb758-14"><a href="em.html#cb758-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_comp =</span> <span class="dv">2</span>,</span>
<span id="cb758-15"><a href="em.html#cb758-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol   =</span> .<span class="dv">00001</span>,</span>
<span id="cb758-16"><a href="em.html#cb758-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits  =</span> <span class="dv">100</span>,</span>
<span id="cb758-17"><a href="em.html#cb758-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits =</span> <span class="cn">TRUE</span></span>
<span id="cb758-18"><a href="em.html#cb758-18" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb758-19"><a href="em.html#cb758-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-20"><a href="em.html#cb758-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments </span></span>
<span id="cb758-21"><a href="em.html#cb758-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X: numeric data</span></span>
<span id="cb758-22"><a href="em.html#cb758-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_comp: number of components</span></span>
<span id="cb758-23"><a href="em.html#cb758-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tol = tolerance level</span></span>
<span id="cb758-24"><a href="em.html#cb758-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># maxits: maximum iterations</span></span>
<span id="cb758-25"><a href="em.html#cb758-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># showits: show iterations</span></span>
<span id="cb758-26"><a href="em.html#cb758-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-27"><a href="em.html#cb758-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># require(pracma) </span></span>
<span id="cb758-28"><a href="em.html#cb758-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-29"><a href="em.html#cb758-29" aria-hidden="true" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">diag</span>(x), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># matrix trace</span></span>
<span id="cb758-30"><a href="em.html#cb758-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-31"><a href="em.html#cb758-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># starting points and other initializations</span></span>
<span id="cb758-32"><a href="em.html#cb758-32" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">nrow</span>(X)</span>
<span id="cb758-33"><a href="em.html#cb758-33" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">=</span> <span class="fu">ncol</span>(X)</span>
<span id="cb758-34"><a href="em.html#cb758-34" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">=</span> n_comp</span>
<span id="cb758-35"><a href="em.html#cb758-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-36"><a href="em.html#cb758-36" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>N) <span class="sc">*</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>X</span>
<span id="cb758-37"><a href="em.html#cb758-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-38"><a href="em.html#cb758-38" aria-hidden="true" tabindex="-1"></a>  evals <span class="ot">=</span> <span class="fu">eigen</span>(S)<span class="sc">$</span>values</span>
<span id="cb758-39"><a href="em.html#cb758-39" aria-hidden="true" tabindex="-1"></a>  evecs <span class="ot">=</span> <span class="fu">eigen</span>(S)<span class="sc">$</span>vectors</span>
<span id="cb758-40"><a href="em.html#cb758-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-41"><a href="em.html#cb758-41" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">=</span> evecs[,<span class="dv">1</span><span class="sc">:</span>L]</span>
<span id="cb758-42"><a href="em.html#cb758-42" aria-hidden="true" tabindex="-1"></a>  Lambda <span class="ot">=</span> <span class="fu">diag</span>(evals[<span class="dv">1</span><span class="sc">:</span>L])</span>
<span id="cb758-43"><a href="em.html#cb758-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-44"><a href="em.html#cb758-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># latent variables</span></span>
<span id="cb758-45"><a href="em.html#cb758-45" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">replicate</span>(L, <span class="fu">rnorm</span>(N))) </span>
<span id="cb758-46"><a href="em.html#cb758-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-47"><a href="em.html#cb758-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variance; average variance associated with discarded dimensions</span></span>
<span id="cb758-48"><a href="em.html#cb758-48" aria-hidden="true" tabindex="-1"></a>  sigma2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(D <span class="sc">-</span> L) <span class="sc">*</span> <span class="fu">sum</span>(evals[(L<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>D])</span>
<span id="cb758-49"><a href="em.html#cb758-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-50"><a href="em.html#cb758-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loadings; this and sigma2 starting points will be near final estimate</span></span>
<span id="cb758-51"><a href="em.html#cb758-51" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">=</span> V <span class="sc">%*%</span> <span class="fu">chol</span>(Lambda <span class="sc">-</span> sigma2 <span class="sc">*</span> <span class="fu">diag</span>(L)) <span class="sc">%*%</span> <span class="fu">diag</span>(L)  </span>
<span id="cb758-52"><a href="em.html#cb758-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-53"><a href="em.html#cb758-53" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb758-54"><a href="em.html#cb758-54" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb758-55"><a href="em.html#cb758-55" aria-hidden="true" tabindex="-1"></a>  ll <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb758-56"><a href="em.html#cb758-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-57"><a href="em.html#cb758-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Show iterations</span></span>
<span id="cb758-58"><a href="em.html#cb758-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                                    </span>
<span id="cb758-59"><a href="em.html#cb758-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb758-60"><a href="em.html#cb758-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-61"><a href="em.html#cb758-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> ((<span class="sc">!</span>converged) <span class="sc">&amp;</span> (it <span class="sc">&lt;</span> maxits)) {                           </span>
<span id="cb758-62"><a href="em.html#cb758-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create &#39;old&#39; values for comparison</span></span>
<span id="cb758-63"><a href="em.html#cb758-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">&#39;W_new&#39;</span>)){</span>
<span id="cb758-64"><a href="em.html#cb758-64" aria-hidden="true" tabindex="-1"></a>      W_old <span class="ot">=</span> W_new</span>
<span id="cb758-65"><a href="em.html#cb758-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb758-66"><a href="em.html#cb758-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb758-67"><a href="em.html#cb758-67" aria-hidden="true" tabindex="-1"></a>      W_old <span class="ot">=</span> W</span>
<span id="cb758-68"><a href="em.html#cb758-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb758-69"><a href="em.html#cb758-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-70"><a href="em.html#cb758-70" aria-hidden="true" tabindex="-1"></a>    ll_old <span class="ot">=</span> ll</span>
<span id="cb758-71"><a href="em.html#cb758-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-72"><a href="em.html#cb758-72" aria-hidden="true" tabindex="-1"></a>    Psi <span class="ot">=</span> sigma2<span class="sc">*</span><span class="fu">diag</span>(L)</span>
<span id="cb758-73"><a href="em.html#cb758-73" aria-hidden="true" tabindex="-1"></a>    M   <span class="ot">=</span> <span class="fu">t</span>(W_old) <span class="sc">%*%</span> W_old <span class="sc">+</span> Psi</span>
<span id="cb758-74"><a href="em.html#cb758-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-75"><a href="em.html#cb758-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># E and M </span></span>
<span id="cb758-76"><a href="em.html#cb758-76" aria-hidden="true" tabindex="-1"></a>    W_new  <span class="ot">=</span> S <span class="sc">%*%</span> W_old <span class="sc">%*%</span> <span class="fu">solve</span>( Psi <span class="sc">+</span> <span class="fu">solve</span>(M) <span class="sc">%*%</span> <span class="fu">t</span>(W_old) <span class="sc">%*%</span> S <span class="sc">%*%</span> W_old )   </span>
<span id="cb758-77"><a href="em.html#cb758-77" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>D <span class="sc">*</span> <span class="fu">tr</span>(S <span class="sc">-</span> S <span class="sc">%*%</span> W_old <span class="sc">%*%</span> <span class="fu">solve</span>(M) <span class="sc">%*%</span> <span class="fu">t</span>(W_new))</span>
<span id="cb758-78"><a href="em.html#cb758-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-79"><a href="em.html#cb758-79" aria-hidden="true" tabindex="-1"></a>    Z  <span class="ot">=</span> <span class="fu">solve</span>(M) <span class="sc">%*%</span> <span class="fu">t</span>(W_new) <span class="sc">%*%</span> <span class="fu">t</span>(X)</span>
<span id="cb758-80"><a href="em.html#cb758-80" aria-hidden="true" tabindex="-1"></a>    ZZ <span class="ot">=</span> sigma2<span class="sc">*</span><span class="fu">solve</span>(M) <span class="sc">+</span> Z<span class="sc">%*%</span><span class="fu">t</span>(Z)</span>
<span id="cb758-81"><a href="em.html#cb758-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-82"><a href="em.html#cb758-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># log likelihood as in paper</span></span>
<span id="cb758-83"><a href="em.html#cb758-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ll = .5*sigma2*D + .5*tr(ZZ) + .5*sigma2 * X%*%t(X) -</span></span>
<span id="cb758-84"><a href="em.html#cb758-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      1/sigma2 * t(Z)%*%t(W_new)%*%t(X) + .5*sigma2 * tr(t(W_new)%*%W_new%*%ZZ)</span></span>
<span id="cb758-85"><a href="em.html#cb758-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ll = -sum(ll)</span></span>
<span id="cb758-86"><a href="em.html#cb758-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-87"><a href="em.html#cb758-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># more straightforward</span></span>
<span id="cb758-88"><a href="em.html#cb758-88" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">dnorm</span>(X, <span class="at">mean =</span> <span class="fu">t</span>(W_new <span class="sc">%*%</span> Z), <span class="at">sd =</span> <span class="fu">sqrt</span>(sigma2), <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb758-89"><a href="em.html#cb758-89" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="sc">-</span><span class="fu">sum</span>(ll)</span>
<span id="cb758-90"><a href="em.html#cb758-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb758-91"><a href="em.html#cb758-91" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb758-92"><a href="em.html#cb758-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-93"><a href="em.html#cb758-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if showits, show first and every 5th iteration</span></span>
<span id="cb758-94"><a href="em.html#cb758-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> (it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>))                          </span>
<span id="cb758-95"><a href="em.html#cb758-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb758-96"><a href="em.html#cb758-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb758-97"><a href="em.html#cb758-97" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(ll_old<span class="sc">-</span>ll)) <span class="sc">&lt;=</span> tol</span>
<span id="cb758-98"><a href="em.html#cb758-98" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb758-99"><a href="em.html#cb758-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-100"><a href="em.html#cb758-100" aria-hidden="true" tabindex="-1"></a>  W     <span class="ot">=</span> pracma<span class="sc">::</span><span class="fu">orth</span>(W_new) <span class="co"># for orthonormal basis of W; pcaMethods package has also</span></span>
<span id="cb758-101"><a href="em.html#cb758-101" aria-hidden="true" tabindex="-1"></a>  evs   <span class="ot">=</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(X <span class="sc">%*%</span> W))</span>
<span id="cb758-102"><a href="em.html#cb758-102" aria-hidden="true" tabindex="-1"></a>  evecs <span class="ot">=</span> evs<span class="sc">$</span>vectors</span>
<span id="cb758-103"><a href="em.html#cb758-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-104"><a href="em.html#cb758-104" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">=</span> W <span class="sc">%*%</span> evecs</span>
<span id="cb758-105"><a href="em.html#cb758-105" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">=</span> X <span class="sc">%*%</span> W</span>
<span id="cb758-106"><a href="em.html#cb758-106" aria-hidden="true" tabindex="-1"></a>  Xrecon   <span class="ot">=</span> Z <span class="sc">%*%</span> <span class="fu">t</span>(W)</span>
<span id="cb758-107"><a href="em.html#cb758-107" aria-hidden="true" tabindex="-1"></a>  reconerr <span class="ot">=</span> <span class="fu">sum</span>((Xrecon <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb758-108"><a href="em.html#cb758-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-109"><a href="em.html#cb758-109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                                     <span class="co"># Show last iteration</span></span>
<span id="cb758-110"><a href="em.html#cb758-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb758-111"><a href="em.html#cb758-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb758-112"><a href="em.html#cb758-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb758-113"><a href="em.html#cb758-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">scores   =</span> Z,</span>
<span id="cb758-114"><a href="em.html#cb758-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">loadings =</span> W,</span>
<span id="cb758-115"><a href="em.html#cb758-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">Xrecon   =</span> Xrecon,</span>
<span id="cb758-116"><a href="em.html#cb758-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">reconerr =</span> reconerr,</span>
<span id="cb758-117"><a href="em.html#cb758-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">ll       =</span> ll,</span>
<span id="cb758-118"><a href="em.html#cb758-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma2   =</span> sigma2</span>
<span id="cb758-119"><a href="em.html#cb758-119" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb758-120"><a href="em.html#cb758-120" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimation-44" class="section level3">
<h3>Estimation</h3>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="em.html#cb759-1" aria-hidden="true" tabindex="-1"></a>fit_em <span class="ot">=</span> <span class="fu">em_ppca</span>(</span>
<span id="cb759-2"><a href="em.html#cb759-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb759-3"><a href="em.html#cb759-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_comp =</span> <span class="dv">2</span>,</span>
<span id="cb759-4"><a href="em.html#cb759-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol   =</span> <span class="fl">1e-12</span>,</span>
<span id="cb759-5"><a href="em.html#cb759-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxit =</span> <span class="dv">100</span></span>
<span id="cb759-6"><a href="em.html#cb759-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
2...</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="em.html#cb761-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fit_em)</span></code></pre></div>
<pre><code>List of 6
 $ scores  : num [1:50, 1:2] 3.79 -1.053 0.867 2.382 0.241 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
  .. ..$ : NULL
 $ loadings: num [1:8, 1:2] 0.126 -0.299 0.468 -0.412 0.444 ...
 $ Xrecon  : num [1:50, 1:8] 0.383 2.109 0.416 -0.228 1.472 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
  .. ..$ : NULL
 $ reconerr: num 136
 $ ll      : num 369
 $ sigma2  : num 0.452</code></pre>
</div>
<div id="comparison-51" class="section level3">
<h3>Comparison</h3>
<p>Extract reconstructed values and loadings for comparison.</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="em.html#cb763-1" aria-hidden="true" tabindex="-1"></a>Xrecon      <span class="ot">=</span> fit_em<span class="sc">$</span>Xrecon</span>
<span id="cb763-2"><a href="em.html#cb763-2" aria-hidden="true" tabindex="-1"></a>loadings_em <span class="ot">=</span> fit_em<span class="sc">$</span>loadings</span>
<span id="cb763-3"><a href="em.html#cb763-3" aria-hidden="true" tabindex="-1"></a>scores_em   <span class="ot">=</span> fit_em<span class="sc">$</span>scores</span></code></pre></div>
<p>Compare to standard pca on full data set if desired.</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="em.html#cb764-1" aria-hidden="true" tabindex="-1"></a>standard_pca <span class="ot">=</span>  <span class="fu">princomp</span>(<span class="fu">scale</span>(state.x77))</span>
<span id="cb764-2"><a href="em.html#cb764-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb764-3"><a href="em.html#cb764-3" aria-hidden="true" tabindex="-1"></a>scores_standard_pca   <span class="ot">=</span> standard_pca<span class="sc">$</span>scores[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb764-4"><a href="em.html#cb764-4" aria-hidden="true" tabindex="-1"></a>loadings_standard_pca <span class="ot">=</span> standard_pca<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb764-5"><a href="em.html#cb764-5" aria-hidden="true" tabindex="-1"></a>Xrecon_standard_pca   <span class="ot">=</span> scores_standard_pca<span class="sc">%*%</span><span class="fu">t</span>(loadings_standard_pca)</span></code></pre></div>
<p>Compare results to output from <span class="pack" style="">pcaMethods</span>, which also has probabilistic PCA (demonstrated next). Note that the signs for loadings/scores may be different</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="em.html#cb765-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pcaMethods)</span>
<span id="cb765-2"><a href="em.html#cb765-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-3"><a href="em.html#cb765-3" aria-hidden="true" tabindex="-1"></a>fit_pcam  <span class="ot">=</span> <span class="fu">pca</span>(</span>
<span id="cb765-4"><a href="em.html#cb765-4" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb765-5"><a href="em.html#cb765-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nPcs =</span> <span class="dv">2</span>,</span>
<span id="cb765-6"><a href="em.html#cb765-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">1e-8</span>,</span>
<span id="cb765-7"><a href="em.html#cb765-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&#39;ppca&#39;</span>,</span>
<span id="cb765-8"><a href="em.html#cb765-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale  =</span> <span class="st">&#39;none&#39;</span>,</span>
<span id="cb765-9"><a href="em.html#cb765-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb765-10"><a href="em.html#cb765-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb765-11"><a href="em.html#cb765-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-12"><a href="em.html#cb765-12" aria-hidden="true" tabindex="-1"></a>loadings_pcam <span class="ot">=</span> <span class="fu">loadings</span>(fit_pcam)</span>
<span id="cb765-13"><a href="em.html#cb765-13" aria-hidden="true" tabindex="-1"></a>scores_pcam   <span class="ot">=</span> <span class="fu">scores</span>(fit_pcam)</span></code></pre></div>
<p>Compare loadings and scores.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="em.html#cb766-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(loadings_pcam, loadings_em, loadings_standard_pca), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>              PC1    PC2               Comp.1 Comp.2
Population  0.126  0.411  0.126  0.411  0.126  0.411
Income     -0.299  0.519 -0.299  0.519 -0.299  0.519
Illiteracy  0.468  0.053  0.468  0.053  0.468  0.053
Life Exp   -0.412 -0.082 -0.412 -0.082 -0.412 -0.082
Murder      0.444  0.307  0.444  0.307  0.444  0.307
HS Grad    -0.425  0.299 -0.425  0.299 -0.425  0.299
Frost      -0.357 -0.154 -0.357 -0.154 -0.357 -0.154
Area       -0.033  0.588 -0.033  0.588 -0.033  0.588</code></pre>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="em.html#cb768-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((<span class="fu">abs</span>(loadings_pcam) <span class="sc">-</span> <span class="fu">abs</span>(loadings_em)) <span class="sc">^</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 1.324404e-18</code></pre>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="em.html#cb770-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(scores_pcam, <span class="fu">data.frame</span>(<span class="at">EM =</span> scores_em)) <span class="sc">%&gt;%</span> </span>
<span id="cb770-2"><a href="em.html#cb770-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>                  PC1        PC2       EM.1       EM.2
Alabama     3.7898873 -0.2347790  3.7898873 -0.2347790
Alaska     -1.0531355  5.4561751 -1.0531355  5.4561751
Arizona     0.8674288  0.7450615  0.8674288  0.7450615
Arkansas    2.3817776 -1.2883437  2.3817776 -1.2883437
California  0.2413815  3.5095228  0.2413815  3.5095228
Colorado   -2.0621814  0.5056639 -2.0621814  0.5056639</code></pre>
<p>Compare reconstructed data sets.</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="em.html#cb772-1" aria-hidden="true" tabindex="-1"></a>Xrecon_pcam <span class="ot">=</span> scores_pcam <span class="sc">%*%</span> <span class="fu">t</span>(loadings_pcam)</span>
<span id="cb772-2"><a href="em.html#cb772-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb772-3"><a href="em.html#cb772-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Xrecon_pcam <span class="sc">-</span> X)<span class="sc">^</span><span class="dv">2</span>)  </span></code></pre></div>
<pre><code>[1] 0.3392252</code></pre>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="em.html#cb774-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(Xrecon_pcam <span class="sc">-</span> Xrecon))</span></code></pre></div>
<pre><code>[1] 3.905797e-10</code></pre>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="em.html#cb776-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(Xrecon_pcam <span class="sc">-</span> Xrecon))</span></code></pre></div>
<pre><code>[1] 3.905797e-10</code></pre>
</div>
<div id="visualize-5" class="section level3">
<h3>Visualize</h3>
<p>Show the reconstructed vs. observed data.</p>
<p><img src="model-demos_files/figure-html/em-ppca-vis-recon-1.svg" width="75%" style="display: block; margin: auto;" /><img src="model-demos_files/figure-html/em-ppca-vis-recon-2.svg" width="75%" style="display: block; margin: auto;" /></p>
<p>Compare component scores.</p>
<p><img src="model-demos_files/figure-html/em-ppca-vis-scores-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="missing-data-example" class="section level3">
<h3>Missing Data Example</h3>
<p>A slightly revised approach can be taken in the case of missing values.</p>
<div id="data-setup-46" class="section level4">
<h4>Data Setup</h4>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="em.html#cb778-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create some missing values</span></span>
<span id="cb778-2"><a href="em.html#cb778-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb778-3"><a href="em.html#cb778-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-4"><a href="em.html#cb778-4" aria-hidden="true" tabindex="-1"></a>X_miss <span class="ot">=</span> X</span>
<span id="cb778-5"><a href="em.html#cb778-5" aria-hidden="true" tabindex="-1"></a>NAindex <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">length</span>(X), <span class="dv">20</span>)</span>
<span id="cb778-6"><a href="em.html#cb778-6" aria-hidden="true" tabindex="-1"></a>X_miss[NAindex] <span class="ot">=</span> <span class="cn">NA</span></span></code></pre></div>
</div>
<div id="function-29" class="section level4">
<h4>Function</h4>
<p>This estimating function largely follows the previous</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="em.html#cb779-1" aria-hidden="true" tabindex="-1"></a>em_ppca_miss <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb779-2"><a href="em.html#cb779-2" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb779-3"><a href="em.html#cb779-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_comp  =</span> <span class="dv">2</span>,</span>
<span id="cb779-4"><a href="em.html#cb779-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol     =</span> .<span class="dv">00001</span>,</span>
<span id="cb779-5"><a href="em.html#cb779-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits  =</span> <span class="dv">100</span>,</span>
<span id="cb779-6"><a href="em.html#cb779-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits =</span> <span class="cn">TRUE</span></span>
<span id="cb779-7"><a href="em.html#cb779-7" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb779-8"><a href="em.html#cb779-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-9"><a href="em.html#cb779-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments </span></span>
<span id="cb779-10"><a href="em.html#cb779-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X: numeric data</span></span>
<span id="cb779-11"><a href="em.html#cb779-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_comp: number of components</span></span>
<span id="cb779-12"><a href="em.html#cb779-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tol: tolerance level</span></span>
<span id="cb779-13"><a href="em.html#cb779-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># maxits: maximum iterations</span></span>
<span id="cb779-14"><a href="em.html#cb779-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># showits: show iterations</span></span>
<span id="cb779-15"><a href="em.html#cb779-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># require(pracma) # for orthonormal basis of W; pcaMethods package has also, see basic orth function</span></span>
<span id="cb779-16"><a href="em.html#cb779-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-17"><a href="em.html#cb779-17" aria-hidden="true" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">diag</span>(x), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)   <span class="co"># matrix trace</span></span>
<span id="cb779-18"><a href="em.html#cb779-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-19"><a href="em.html#cb779-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># starting points and other initializations</span></span>
<span id="cb779-20"><a href="em.html#cb779-20" aria-hidden="true" tabindex="-1"></a>  X_orig <span class="ot">=</span> X</span>
<span id="cb779-21"><a href="em.html#cb779-21" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> X</span>
<span id="cb779-22"><a href="em.html#cb779-22" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">nrow</span>(X_orig)</span>
<span id="cb779-23"><a href="em.html#cb779-23" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">=</span> <span class="fu">ncol</span>(X_orig)</span>
<span id="cb779-24"><a href="em.html#cb779-24" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">=</span> n_comp</span>
<span id="cb779-25"><a href="em.html#cb779-25" aria-hidden="true" tabindex="-1"></a>  NAs <span class="ot">=</span> <span class="fu">is.na</span>(X_orig)</span>
<span id="cb779-26"><a href="em.html#cb779-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-27"><a href="em.html#cb779-27" aria-hidden="true" tabindex="-1"></a>  X[NAs] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb779-28"><a href="em.html#cb779-28" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> (<span class="dv">1</span><span class="sc">/</span>N) <span class="sc">*</span> <span class="fu">t</span>(X)<span class="sc">%*%</span>X</span>
<span id="cb779-29"><a href="em.html#cb779-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-30"><a href="em.html#cb779-30" aria-hidden="true" tabindex="-1"></a>  evals <span class="ot">=</span> <span class="fu">eigen</span>(S)<span class="sc">$</span>values</span>
<span id="cb779-31"><a href="em.html#cb779-31" aria-hidden="true" tabindex="-1"></a>  evecs <span class="ot">=</span> <span class="fu">eigen</span>(S)<span class="sc">$</span>vectors</span>
<span id="cb779-32"><a href="em.html#cb779-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-33"><a href="em.html#cb779-33" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">=</span> evecs[,<span class="dv">1</span><span class="sc">:</span>L]</span>
<span id="cb779-34"><a href="em.html#cb779-34" aria-hidden="true" tabindex="-1"></a>  Lambda <span class="ot">=</span> <span class="fu">diag</span>(evals[<span class="dv">1</span><span class="sc">:</span>L])</span>
<span id="cb779-35"><a href="em.html#cb779-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-36"><a href="em.html#cb779-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># latent variables</span></span>
<span id="cb779-37"><a href="em.html#cb779-37" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">replicate</span>(L, <span class="fu">rnorm</span>(N))) </span>
<span id="cb779-38"><a href="em.html#cb779-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-39"><a href="em.html#cb779-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># variance; average variance associated with discarded dimensions</span></span>
<span id="cb779-40"><a href="em.html#cb779-40" aria-hidden="true" tabindex="-1"></a>  sigma2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(D<span class="sc">-</span>L) <span class="sc">*</span> <span class="fu">sum</span>(evals[(L<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>D])</span>
<span id="cb779-41"><a href="em.html#cb779-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-42"><a href="em.html#cb779-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loadings</span></span>
<span id="cb779-43"><a href="em.html#cb779-43" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">=</span> V <span class="sc">%*%</span> <span class="fu">chol</span>(Lambda<span class="sc">-</span>sigma2<span class="sc">*</span><span class="fu">diag</span>(L)) <span class="sc">%*%</span> <span class="fu">diag</span>(L)           </span>
<span id="cb779-44"><a href="em.html#cb779-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-45"><a href="em.html#cb779-45" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb779-46"><a href="em.html#cb779-46" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb779-47"><a href="em.html#cb779-47" aria-hidden="true" tabindex="-1"></a>  ll <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb779-48"><a href="em.html#cb779-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-49"><a href="em.html#cb779-49" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Show iterations</span></span>
<span id="cb779-50"><a href="em.html#cb779-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)</span>
<span id="cb779-51"><a href="em.html#cb779-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb779-52"><a href="em.html#cb779-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-53"><a href="em.html#cb779-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> ((<span class="sc">!</span>converged) <span class="sc">&amp;</span> (it <span class="sc">&lt;</span> maxits)) {                  </span>
<span id="cb779-54"><a href="em.html#cb779-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">exists</span>(<span class="st">&#39;W_new&#39;</span>)){</span>
<span id="cb779-55"><a href="em.html#cb779-55" aria-hidden="true" tabindex="-1"></a>      W_old <span class="ot">=</span> W_new</span>
<span id="cb779-56"><a href="em.html#cb779-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb779-57"><a href="em.html#cb779-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb779-58"><a href="em.html#cb779-58" aria-hidden="true" tabindex="-1"></a>      W_old <span class="ot">=</span> W</span>
<span id="cb779-59"><a href="em.html#cb779-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb779-60"><a href="em.html#cb779-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-61"><a href="em.html#cb779-61" aria-hidden="true" tabindex="-1"></a>    ll_old <span class="ot">=</span> ll</span>
<span id="cb779-62"><a href="em.html#cb779-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-63"><a href="em.html#cb779-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># deal with missingness via projection</span></span>
<span id="cb779-64"><a href="em.html#cb779-64" aria-hidden="true" tabindex="-1"></a>    proj  <span class="ot">=</span> <span class="fu">t</span>(W_old<span class="sc">%*%</span>Z)</span>
<span id="cb779-65"><a href="em.html#cb779-65" aria-hidden="true" tabindex="-1"></a>    X_new <span class="ot">=</span> X_orig</span>
<span id="cb779-66"><a href="em.html#cb779-66" aria-hidden="true" tabindex="-1"></a>    X_new[NAs] <span class="ot">=</span> proj[NAs]</span>
<span id="cb779-67"><a href="em.html#cb779-67" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">=</span> X_new</span>
<span id="cb779-68"><a href="em.html#cb779-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-69"><a href="em.html#cb779-69" aria-hidden="true" tabindex="-1"></a>    Psi <span class="ot">=</span> sigma2<span class="sc">*</span><span class="fu">diag</span>(L)</span>
<span id="cb779-70"><a href="em.html#cb779-70" aria-hidden="true" tabindex="-1"></a>    M   <span class="ot">=</span> <span class="fu">t</span>(W_old) <span class="sc">%*%</span> W_old <span class="sc">+</span> Psi</span>
<span id="cb779-71"><a href="em.html#cb779-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-72"><a href="em.html#cb779-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># E and M</span></span>
<span id="cb779-73"><a href="em.html#cb779-73" aria-hidden="true" tabindex="-1"></a>    W_new  <span class="ot">=</span> S <span class="sc">%*%</span> W_old <span class="sc">%*%</span> <span class="fu">solve</span>( Psi <span class="sc">+</span> <span class="fu">solve</span>(M)<span class="sc">%*%</span><span class="fu">t</span>(W_old)<span class="sc">%*%</span>S<span class="sc">%*%</span>W_old )</span>
<span id="cb779-74"><a href="em.html#cb779-74" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>D <span class="sc">*</span> <span class="fu">tr</span>(S <span class="sc">-</span> S<span class="sc">%*%</span>W_old<span class="sc">%*%</span><span class="fu">solve</span>(M)<span class="sc">%*%</span><span class="fu">t</span>(W_new))</span>
<span id="cb779-75"><a href="em.html#cb779-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-76"><a href="em.html#cb779-76" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">=</span> <span class="fu">solve</span>(M)<span class="sc">%*%</span><span class="fu">t</span>(W_new)<span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb779-77"><a href="em.html#cb779-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-78"><a href="em.html#cb779-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-79"><a href="em.html#cb779-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># log likelihood as in paper</span></span>
<span id="cb779-80"><a href="em.html#cb779-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ZZ = sigma2*solve(M) + Z%*%t(Z)</span></span>
<span id="cb779-81"><a href="em.html#cb779-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ll = .5*sigma2*D + .5*tr(ZZ) + .5*sigma2 * X%*%t(X) -</span></span>
<span id="cb779-82"><a href="em.html#cb779-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">#      1/sigma2 * t(Z)%*%t(W_new)%*%t(X) + .5*sigma2 * tr(t(W_new)%*%W_new%*%ZZ)</span></span>
<span id="cb779-83"><a href="em.html#cb779-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ll = -sum(ll)</span></span>
<span id="cb779-84"><a href="em.html#cb779-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-85"><a href="em.html#cb779-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># more straightforward</span></span>
<span id="cb779-86"><a href="em.html#cb779-86" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="fu">dnorm</span>(X, <span class="at">mean =</span> <span class="fu">t</span>(W_new <span class="sc">%*%</span> Z), <span class="at">sd =</span> <span class="fu">sqrt</span>(sigma2), <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb779-87"><a href="em.html#cb779-87" aria-hidden="true" tabindex="-1"></a>    ll <span class="ot">=</span> <span class="sc">-</span><span class="fu">sum</span>(ll)</span>
<span id="cb779-88"><a href="em.html#cb779-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb779-89"><a href="em.html#cb779-89" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb779-90"><a href="em.html#cb779-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-91"><a href="em.html#cb779-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if showits, show first and every 5th iteration</span></span>
<span id="cb779-92"><a href="em.html#cb779-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> (it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>))                          </span>
<span id="cb779-93"><a href="em.html#cb779-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb779-94"><a href="em.html#cb779-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb779-95"><a href="em.html#cb779-95" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(ll_old<span class="sc">-</span>ll)) <span class="sc">&lt;=</span> tol</span>
<span id="cb779-96"><a href="em.html#cb779-96" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb779-97"><a href="em.html#cb779-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-98"><a href="em.html#cb779-98" aria-hidden="true" tabindex="-1"></a>  W     <span class="ot">=</span> pracma<span class="sc">::</span><span class="fu">orth</span>(W_new)   <span class="co"># for orthonormal basis of W</span></span>
<span id="cb779-99"><a href="em.html#cb779-99" aria-hidden="true" tabindex="-1"></a>  evs   <span class="ot">=</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(X <span class="sc">%*%</span> W))</span>
<span id="cb779-100"><a href="em.html#cb779-100" aria-hidden="true" tabindex="-1"></a>  evecs <span class="ot">=</span> evs<span class="sc">$</span>vectors</span>
<span id="cb779-101"><a href="em.html#cb779-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-102"><a href="em.html#cb779-102" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">=</span> W <span class="sc">%*%</span> evecs</span>
<span id="cb779-103"><a href="em.html#cb779-103" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">=</span> X <span class="sc">%*%</span> W</span>
<span id="cb779-104"><a href="em.html#cb779-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-105"><a href="em.html#cb779-105" aria-hidden="true" tabindex="-1"></a>  Xrecon   <span class="ot">=</span> Z <span class="sc">%*%</span> <span class="fu">t</span>(W)</span>
<span id="cb779-106"><a href="em.html#cb779-106" aria-hidden="true" tabindex="-1"></a>  reconerr <span class="ot">=</span> <span class="fu">sum</span>((Xrecon<span class="sc">-</span>X)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb779-107"><a href="em.html#cb779-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-108"><a href="em.html#cb779-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                                     <span class="co"># Show last iteration</span></span>
<span id="cb779-109"><a href="em.html#cb779-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb779-110"><a href="em.html#cb779-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb779-111"><a href="em.html#cb779-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb779-112"><a href="em.html#cb779-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">scores   =</span> Z,</span>
<span id="cb779-113"><a href="em.html#cb779-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">loadings =</span> W,</span>
<span id="cb779-114"><a href="em.html#cb779-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">Xrecon   =</span> Xrecon,</span>
<span id="cb779-115"><a href="em.html#cb779-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">reconerr =</span> reconerr,</span>
<span id="cb779-116"><a href="em.html#cb779-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">ll       =</span> ll,</span>
<span id="cb779-117"><a href="em.html#cb779-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma2   =</span> sigma2</span>
<span id="cb779-118"><a href="em.html#cb779-118" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb779-119"><a href="em.html#cb779-119" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimation-45" class="section level4">
<h4>Estimation</h4>
<p>Run the PCA.</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="em.html#cb780-1" aria-hidden="true" tabindex="-1"></a>fit_em_miss <span class="ot">=</span> <span class="fu">em_ppca_miss</span>(</span>
<span id="cb780-2"><a href="em.html#cb780-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X_miss,</span>
<span id="cb780-3"><a href="em.html#cb780-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_comp =</span> <span class="dv">2</span>,</span>
<span id="cb780-4"><a href="em.html#cb780-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol   =</span> <span class="fl">1e-8</span>,</span>
<span id="cb780-5"><a href="em.html#cb780-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxit =</span> <span class="dv">100</span></span>
<span id="cb780-6"><a href="em.html#cb780-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>Iterations of EM: 
1...
5...
10...
15...
19...</code></pre>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="em.html#cb782-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fit_em_miss)</span></code></pre></div>
<pre><code>List of 6
 $ scores  : num [1:50, 1:2] 3.79 -1.07 0.86 2.35 0.24 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
  .. ..$ : NULL
 $ loadings: num [1:8, 1:2] 0.133 -0.299 0.422 -0.431 0.464 ...
 $ Xrecon  : num [1:50, 1:8] 0.414 1.998 0.448 -0.2 1.521 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:50] &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...
  .. ..$ : NULL
 $ reconerr: num 130
 $ ll      : num 368
 $ sigma2  : num 0.475</code></pre>
</div>
<div id="comparison-52" class="section level4">
<h4>Comparison</h4>
<p>Extract reconstructed values and loadings for comparison.</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="em.html#cb784-1" aria-hidden="true" tabindex="-1"></a>Xrecon      <span class="ot">=</span> fit_em_miss<span class="sc">$</span>Xrecon</span>
<span id="cb784-2"><a href="em.html#cb784-2" aria-hidden="true" tabindex="-1"></a>loadings_em <span class="ot">=</span> fit_em_miss<span class="sc">$</span>loadings</span>
<span id="cb784-3"><a href="em.html#cb784-3" aria-hidden="true" tabindex="-1"></a>scores_em   <span class="ot">=</span> fit_em_miss<span class="sc">$</span>scores</span></code></pre></div>
<p>Compare to standard pca on full data set if desired.</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="em.html#cb785-1" aria-hidden="true" tabindex="-1"></a>standard_pca <span class="ot">=</span>  <span class="fu">prin_comp</span>(<span class="fu">scale</span>(state.x77))</span>
<span id="cb785-2"><a href="em.html#cb785-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb785-3"><a href="em.html#cb785-3" aria-hidden="true" tabindex="-1"></a>scores_standard_pca   <span class="ot">=</span> standard_pca<span class="sc">$</span>scores[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb785-4"><a href="em.html#cb785-4" aria-hidden="true" tabindex="-1"></a>loadings_standard_pca <span class="ot">=</span> standard_pca<span class="sc">$</span>loadings[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb785-5"><a href="em.html#cb785-5" aria-hidden="true" tabindex="-1"></a>Xrecon_standard_pca   <span class="ot">=</span> scores_standard_pca<span class="sc">%*%</span><span class="fu">t</span>(loadings_standard_pca)</span></code></pre></div>
<p>Compare results to output from <span class="pack" style="">pcaMethods</span>, which also has probabilistic PCA (demonstrated next). Note that the signs for loadings/scores may be different</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="em.html#cb786-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pcaMethods)</span>
<span id="cb786-2"><a href="em.html#cb786-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-3"><a href="em.html#cb786-3" aria-hidden="true" tabindex="-1"></a>fit_pcam  <span class="ot">=</span> <span class="fu">pca</span>(</span>
<span id="cb786-4"><a href="em.html#cb786-4" aria-hidden="true" tabindex="-1"></a>  X_miss,</span>
<span id="cb786-5"><a href="em.html#cb786-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nPcs =</span> <span class="dv">2</span>,</span>
<span id="cb786-6"><a href="em.html#cb786-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">1e-8</span>,</span>
<span id="cb786-7"><a href="em.html#cb786-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&#39;ppca&#39;</span>,</span>
<span id="cb786-8"><a href="em.html#cb786-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale  =</span> <span class="st">&#39;none&#39;</span>,</span>
<span id="cb786-9"><a href="em.html#cb786-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">FALSE</span></span>
<span id="cb786-10"><a href="em.html#cb786-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb786-11"><a href="em.html#cb786-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-12"><a href="em.html#cb786-12" aria-hidden="true" tabindex="-1"></a>loadings_pcam <span class="ot">=</span> <span class="fu">loadings</span>(fit_pcam)</span>
<span id="cb786-13"><a href="em.html#cb786-13" aria-hidden="true" tabindex="-1"></a>scores_pcam   <span class="ot">=</span> <span class="fu">scores</span>(fit_pcam)</span></code></pre></div>
<p>Compare loadings and scores.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="em.html#cb787-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(loadings_pcam, loadings_em, loadings_standard_pca), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>              PC1    PC2               Comp.1 Comp.2
Population -0.128 -0.416  0.133  0.396  0.126  0.411
Income      0.305 -0.492 -0.299  0.537 -0.299  0.519
Illiteracy -0.434 -0.046  0.422  0.076  0.468  0.053
Life Exp    0.432  0.077 -0.431 -0.080 -0.412 -0.082
Murder     -0.464 -0.284  0.464  0.290  0.444  0.307
HS Grad     0.424 -0.288 -0.433  0.318 -0.425  0.299
Frost       0.346  0.170 -0.353 -0.185 -0.357 -0.154
Area        0.041 -0.620 -0.037  0.569 -0.033  0.588</code></pre>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="em.html#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((<span class="fu">abs</span>(loadings_pcam) <span class="sc">-</span> <span class="fu">abs</span>(loadings_em)) <span class="sc">^</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>[1] 0.00738241</code></pre>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="em.html#cb791-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(scores_pcam, <span class="fu">data.frame</span>(<span class="at">EM =</span> scores_em)) <span class="sc">%&gt;%</span> </span>
<span id="cb791-2"><a href="em.html#cb791-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>                  PC1        PC2       EM.1       EM.2
Alabama    -3.7959034  0.2274074  3.7935243 -0.2316100
Alaska      1.0806631 -5.4908857 -1.0714535  5.4128832
Arizona    -0.8672862 -0.7758984  0.8599622  0.8425754
Arkansas   -2.3599676  1.2461202  2.3527582 -1.3002423
California -0.1899324 -4.0171723  0.2399266  3.7656674
Colorado    1.4732282 -0.4045470 -1.4689157  0.4135982</code></pre>
<p>Compare reconstructed data sets.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="em.html#cb793-1" aria-hidden="true" tabindex="-1"></a>Xrecon_pcam <span class="ot">=</span> scores_pcam <span class="sc">%*%</span> <span class="fu">t</span>(loadings_pcam)</span>
<span id="cb793-2"><a href="em.html#cb793-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb793-3"><a href="em.html#cb793-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((Xrecon_pcam[NAindex]<span class="sc">-</span>X[NAindex])<span class="sc">^</span><span class="dv">2</span>)  </span></code></pre></div>
<pre><code>[1] 0.5047378</code></pre>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="em.html#cb795-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">abs</span>(Xrecon_pcam <span class="sc">-</span> Xrecon))</span></code></pre></div>
<pre><code>[1] 0.02893291</code></pre>
</div>
<div id="visualize-6" class="section level4">
<h4>Visualize</h4>
<p>Visualize as before</p>
<p><img src="model-demos_files/figure-html/em-ppca-miss-vis-recon-1.svg" width="75%" style="display: block; margin: auto;" /><img src="model-demos_files/figure-html/em-ppca-miss-vis-recon-2.svg" width="75%" style="display: block; margin: auto;" /></p>
<p><img src="model-demos_files/figure-html/em-ppca-miss-vis-scores-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="source-47" class="section level3">
<h3>Source</h3>
<p>Original code available at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20algorithm%20for%20ppca.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20algorithm%20for%20ppca.R</a></p>
<p>Original code for the missing example found at
(<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20algorithm%20for%20ppca%20with%20missing.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20algorithm%20for%20ppca%20with%20missing.R</a></p>
</div>
</div>
<div id="state-space-model" class="section level2">
<h2>State Space Model</h2>
<p>The following regards chapter 11 in Statistical Modeling and Computation, the
first example for an unobserved components model. The data regards inflation
based on the U.S. consumer price index (<span class="math inline">\(\textrm{infl} = 400*log(cpi_t/cpi_{t-1})\)</span>), from
the second quarter of 1947 to the second quarter of 2011. You can acquire the
data <a href="http://www.maths.uq.edu.au/~kroese/statbook/Statespace/USCPI.csv">here</a> or
in <a href="https://github.com/m-clark/Datasets">Datasets repo</a>. Just note that it has 2
mystery columns and one mystery row presumably supplied by Excel. You can also
get the CPI data yourself at the <a href="http://www.bls.gov/cpi/">Bureau of Labor
Statistics</a> in a frustrating fashion, or in a much
easier fashion <a href="https://fred.stlouisfed.org/series/CPIAUCSL">here</a>.</p>
<p>For the following I use <code>n</code> instead of <code>t</code> or <code>T</code> because those are transpose and <code>TRUE</code>
in R. The model is basically y = τ + ϵ, with ϵ ~ N(0, σ<sup>2</sup>), and τ = τ<sub>n-1<sub> +
υ_n with υ ~ N(0, ω<sup>2</sup>). Thus each y is associated with a latent variable that
follows a random walk over time. ω<sup>2</sup> serves as a smoothing parameter, which
itself may be estimated but which is fixed in the following. See the text for
more details.</p>
<div id="data-setup-47" class="section level3">
<h3>Data Setup</h3>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="em.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb797-2"><a href="em.html#cb797-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-3"><a href="em.html#cb797-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">read_csv</span>(</span>
<span id="cb797-4"><a href="em.html#cb797-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;https://raw.githubusercontent.com/m-clark/Datasets/master/us%20cpi/USCPI.csv&#39;</span>,</span>
<span id="cb797-5"><a href="em.html#cb797-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">FALSE</span></span>
<span id="cb797-6"><a href="em.html#cb797-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb797-7"><a href="em.html#cb797-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-8"><a href="em.html#cb797-8" aria-hidden="true" tabindex="-1"></a>inflation <span class="ot">=</span> <span class="fu">as.matrix</span>(d<span class="sc">$</span>X1)</span>
<span id="cb797-9"><a href="em.html#cb797-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb797-10"><a href="em.html#cb797-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(inflation)</span></code></pre></div>
<pre><code>       V1        
 Min.   :-9.557  
 1st Qu.: 1.843  
 Median : 3.248  
 Mean   : 3.634  
 3rd Qu.: 4.819  
 Max.   :15.931  </code></pre>
</div>
<div id="function-30" class="section level3">
<h3>Function</h3>
<p>EM function for a state space model.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="em.html#cb799-1" aria-hidden="true" tabindex="-1"></a>em_state_space <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb799-2"><a href="em.html#cb799-2" aria-hidden="true" tabindex="-1"></a>  params,</span>
<span id="cb799-3"><a href="em.html#cb799-3" aria-hidden="true" tabindex="-1"></a>  y,</span>
<span id="cb799-4"><a href="em.html#cb799-4" aria-hidden="true" tabindex="-1"></a>  omega2_0,</span>
<span id="cb799-5"><a href="em.html#cb799-5" aria-hidden="true" tabindex="-1"></a>  omega2,</span>
<span id="cb799-6"><a href="em.html#cb799-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol     =</span> .<span class="dv">00001</span>,</span>
<span id="cb799-7"><a href="em.html#cb799-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxits  =</span> <span class="dv">100</span>,</span>
<span id="cb799-8"><a href="em.html#cb799-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">showits =</span> <span class="cn">FALSE</span></span>
<span id="cb799-9"><a href="em.html#cb799-9" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb799-10"><a href="em.html#cb799-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-11"><a href="em.html#cb799-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Arguments </span></span>
<span id="cb799-12"><a href="em.html#cb799-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># params: starting parameters (variance as &#39;sigma2&#39;), </span></span>
<span id="cb799-13"><a href="em.html#cb799-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y: data, </span></span>
<span id="cb799-14"><a href="em.html#cb799-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tol: tolerance,</span></span>
<span id="cb799-15"><a href="em.html#cb799-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># omega2: latent variance (2_0) is a noisier starting variance</span></span>
<span id="cb799-16"><a href="em.html#cb799-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># maxits: maximum iterations</span></span>
<span id="cb799-17"><a href="em.html#cb799-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># showits: whether to show iterations</span></span>
<span id="cb799-18"><a href="em.html#cb799-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-19"><a href="em.html#cb799-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Not really needed here, but would be a good idea generally to take advantage</span></span>
<span id="cb799-20"><a href="em.html#cb799-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of sparse representation for large data</span></span>
<span id="cb799-21"><a href="em.html#cb799-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># require(spam)  # see usage below</span></span>
<span id="cb799-22"><a href="em.html#cb799-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-23"><a href="em.html#cb799-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Starting points</span></span>
<span id="cb799-24"><a href="em.html#cb799-24" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">length</span>(y)</span>
<span id="cb799-25"><a href="em.html#cb799-25" aria-hidden="true" tabindex="-1"></a>  sigma2 <span class="ot">=</span> params<span class="sc">$</span>sigma2</span>
<span id="cb799-26"><a href="em.html#cb799-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-27"><a href="em.html#cb799-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Other initializations</span></span>
<span id="cb799-28"><a href="em.html#cb799-28" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">=</span> <span class="fu">diag</span>(n)</span>
<span id="cb799-29"><a href="em.html#cb799-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-30"><a href="em.html#cb799-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(H) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb799-31"><a href="em.html#cb799-31" aria-hidden="true" tabindex="-1"></a>    H[i <span class="sc">+</span> <span class="dv">1</span>, i] <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb799-32"><a href="em.html#cb799-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb799-33"><a href="em.html#cb799-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-34"><a href="em.html#cb799-34" aria-hidden="true" tabindex="-1"></a>  Omega2 <span class="ot">=</span> spam<span class="sc">::</span><span class="fu">as.spam</span>(<span class="fu">diag</span>(omega2, n))</span>
<span id="cb799-35"><a href="em.html#cb799-35" aria-hidden="true" tabindex="-1"></a>  Omega2[<span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">=</span> omega2_0</span>
<span id="cb799-36"><a href="em.html#cb799-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-37"><a href="em.html#cb799-37" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">=</span> spam<span class="sc">::</span><span class="fu">as.spam</span>(H)</span>
<span id="cb799-38"><a href="em.html#cb799-38" aria-hidden="true" tabindex="-1"></a>  HinvOmega2H <span class="ot">=</span> <span class="fu">t</span>(H) <span class="sc">%*%</span> spam<span class="sc">::</span><span class="fu">chol2inv</span>(spam<span class="sc">::</span><span class="fu">chol</span>(Omega2)) <span class="sc">%*%</span> H   <span class="co"># tau ~ N(0, HinvOmmega2H^-1)</span></span>
<span id="cb799-39"><a href="em.html#cb799-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-40"><a href="em.html#cb799-40" aria-hidden="true" tabindex="-1"></a>  it <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb799-41"><a href="em.html#cb799-41" aria-hidden="true" tabindex="-1"></a>  converged <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb799-42"><a href="em.html#cb799-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-43"><a href="em.html#cb799-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showits)                                    <span class="co"># Show iterations</span></span>
<span id="cb799-44"><a href="em.html#cb799-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Iterations of EM:&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb799-45"><a href="em.html#cb799-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-46"><a href="em.html#cb799-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> ((<span class="sc">!</span>converged) <span class="sc">&amp;</span> (it <span class="sc">&lt;</span> maxits)) { </span>
<span id="cb799-47"><a href="em.html#cb799-47" aria-hidden="true" tabindex="-1"></a>    sigma2Old    <span class="ot">=</span> sigma2[<span class="dv">1</span>]</span>
<span id="cb799-48"><a href="em.html#cb799-48" aria-hidden="true" tabindex="-1"></a>    Sigma2invOld <span class="ot">=</span> <span class="fu">diag</span>(n)<span class="sc">/</span>sigma2Old</span>
<span id="cb799-49"><a href="em.html#cb799-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb799-50"><a href="em.html#cb799-50" aria-hidden="true" tabindex="-1"></a>    K   <span class="ot">=</span> HinvOmega2H <span class="sc">+</span> Sigma2invOld              <span class="co"># E</span></span>
<span id="cb799-51"><a href="em.html#cb799-51" aria-hidden="true" tabindex="-1"></a>    tau <span class="ot">=</span> <span class="fu">solve</span>(K, y<span class="sc">/</span>sigma2Old)                   <span class="co"># tau|y, sigma2_{n-1}, omega2 ~ N(0, K^-1)</span></span>
<span id="cb799-52"><a href="em.html#cb799-52" aria-hidden="true" tabindex="-1"></a>    K_inv_tr <span class="ot">=</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">eigen</span>(K)<span class="sc">$</span>values)</span>
<span id="cb799-53"><a href="em.html#cb799-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb799-54"><a href="em.html#cb799-54" aria-hidden="true" tabindex="-1"></a>    sigma2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>n <span class="sc">*</span> (K_inv_tr <span class="sc">+</span> <span class="fu">crossprod</span>(y<span class="sc">-</span>tau))  <span class="co"># M</span></span>
<span id="cb799-55"><a href="em.html#cb799-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb799-56"><a href="em.html#cb799-56" aria-hidden="true" tabindex="-1"></a>    converged <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">abs</span>(sigma2 <span class="sc">-</span> sigma2Old)) <span class="sc">&lt;=</span> tol</span>
<span id="cb799-57"><a href="em.html#cb799-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb799-58"><a href="em.html#cb799-58" aria-hidden="true" tabindex="-1"></a>    it <span class="ot">=</span> it <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb799-59"><a href="em.html#cb799-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb799-60"><a href="em.html#cb799-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if showits true, &amp; it =1 or divisible by 5 print message</span></span>
<span id="cb799-61"><a href="em.html#cb799-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (showits <span class="sc">&amp;</span> it <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> it<span class="sc">%%</span><span class="dv">5</span> <span class="sc">==</span> <span class="dv">0</span>)        </span>
<span id="cb799-62"><a href="em.html#cb799-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">format</span>(it), <span class="st">&quot;...&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb799-63"><a href="em.html#cb799-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb799-64"><a href="em.html#cb799-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-65"><a href="em.html#cb799-65" aria-hidden="true" tabindex="-1"></a>  Kfinal   <span class="ot">=</span> HinvOmega2H <span class="sc">+</span> <span class="fu">diag</span>(n) <span class="sc">/</span> sigma2[<span class="dv">1</span>]</span>
<span id="cb799-66"><a href="em.html#cb799-66" aria-hidden="true" tabindex="-1"></a>  taufinal <span class="ot">=</span> <span class="fu">solve</span>(K, (y <span class="sc">/</span> sigma2[<span class="dv">1</span>]))</span>
<span id="cb799-67"><a href="em.html#cb799-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb799-68"><a href="em.html#cb799-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">sigma2 =</span> sigma2, <span class="at">tau =</span> taufinal)</span>
<span id="cb799-69"><a href="em.html#cb799-69" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimation-46" class="section level3">
<h3>Estimation</h3>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="em.html#cb800-1" aria-hidden="true" tabindex="-1"></a>ss_mod_1 <span class="ot">=</span> <span class="fu">em_state_space</span>(</span>
<span id="cb800-2"><a href="em.html#cb800-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">data.frame</span>(<span class="at">sigma2 =</span> <span class="fu">var</span>(inflation)),</span>
<span id="cb800-3"><a href="em.html#cb800-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y      =</span> inflation,</span>
<span id="cb800-4"><a href="em.html#cb800-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol    =</span> <span class="fl">1e-10</span>,</span>
<span id="cb800-5"><a href="em.html#cb800-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">omega2_0 =</span> <span class="dv">9</span>,</span>
<span id="cb800-6"><a href="em.html#cb800-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">omega2   =</span> <span class="dv">1</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb800-7"><a href="em.html#cb800-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>5...
10...
15...
20...
25...
30...</code></pre>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="em.html#cb802-1" aria-hidden="true" tabindex="-1"></a>ss_mod_<span class="fl">.5</span> <span class="ot">=</span> <span class="fu">em_state_space</span>(</span>
<span id="cb802-2"><a href="em.html#cb802-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">data.frame</span>(<span class="at">sigma2 =</span> <span class="fu">var</span>(inflation)),</span>
<span id="cb802-3"><a href="em.html#cb802-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y      =</span> inflation,</span>
<span id="cb802-4"><a href="em.html#cb802-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol    =</span> <span class="fl">1e-10</span>,</span>
<span id="cb802-5"><a href="em.html#cb802-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">omega2_0 =</span> <span class="dv">9</span>,</span>
<span id="cb802-6"><a href="em.html#cb802-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">omega2   =</span> .<span class="dv">5</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb802-7"><a href="em.html#cb802-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>5...
10...
15...
20...</code></pre>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="em.html#cb804-1" aria-hidden="true" tabindex="-1"></a><span class="co"># more smooth</span></span>
<span id="cb804-2"><a href="em.html#cb804-2" aria-hidden="true" tabindex="-1"></a>ss_mod_<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">em_state_space</span>(</span>
<span id="cb804-3"><a href="em.html#cb804-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">data.frame</span>(<span class="at">sigma2 =</span> <span class="fu">var</span>(inflation)),</span>
<span id="cb804-4"><a href="em.html#cb804-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y      =</span> inflation,</span>
<span id="cb804-5"><a href="em.html#cb804-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tol    =</span> <span class="fl">1e-10</span>,</span>
<span id="cb804-6"><a href="em.html#cb804-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">omega2_0 =</span> <span class="dv">9</span>,</span>
<span id="cb804-7"><a href="em.html#cb804-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">omega2   =</span> .<span class="dv">1</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb804-8"><a href="em.html#cb804-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>5...
10...</code></pre>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="em.html#cb806-1" aria-hidden="true" tabindex="-1"></a>ss_mod_1<span class="sc">$</span>sigma2</span></code></pre></div>
<pre><code>         [,1]
[1,] 2.765182</code></pre>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="em.html#cb808-1" aria-hidden="true" tabindex="-1"></a>ss_mod_<span class="fl">.5</span><span class="sc">$</span>sigma2</span></code></pre></div>
<pre><code>         [,1]
[1,] 4.404707</code></pre>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="em.html#cb810-1" aria-hidden="true" tabindex="-1"></a>ss_mod_<span class="fl">.1</span><span class="sc">$</span>sigma2</span></code></pre></div>
<pre><code>         [,1]
[1,] 7.489429</code></pre>
</div>
<div id="visualization-6" class="section level3">
<h3>Visualization</h3>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="em.html#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb812-2"><a href="em.html#cb812-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb812-3"><a href="em.html#cb812-3" aria-hidden="true" tabindex="-1"></a>series <span class="ot">=</span> <span class="fu">ymd</span>(</span>
<span id="cb812-4"><a href="em.html#cb812-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb812-5"><a href="em.html#cb812-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1947</span><span class="sc">:</span><span class="dv">2014</span>, <span class="at">e =</span> <span class="dv">4</span>), </span>
<span id="cb812-6"><a href="em.html#cb812-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;-&#39;</span>, </span>
<span id="cb812-7"><a href="em.html#cb812-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&#39;01&#39;</span>, <span class="st">&#39;04&#39;</span>, <span class="st">&#39;07&#39;</span>, <span class="st">&#39;10&#39;</span>), </span>
<span id="cb812-8"><a href="em.html#cb812-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;-&#39;</span>, </span>
<span id="cb812-9"><a href="em.html#cb812-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;01&#39;</span>)</span>
<span id="cb812-10"><a href="em.html#cb812-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The following corresponds to Fig. 11.1 in the text. We’ll also compare to generalized additive model via <span class="func" style="">geom_smooth</span> (greenish line). We can see the .1 model (light blue) is overly smooth.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="em.html#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb813-2"><a href="em.html#cb813-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-3"><a href="em.html#cb813-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb813-4"><a href="em.html#cb813-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">series =</span> series[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(inflation)],</span>
<span id="cb813-5"><a href="em.html#cb813-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">inflation =</span> inflation,</span>
<span id="cb813-6"><a href="em.html#cb813-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mod_1  =</span> ss_mod_1<span class="sc">$</span>tau,</span>
<span id="cb813-7"><a href="em.html#cb813-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mod_.5 =</span> ss_mod_<span class="fl">.5</span><span class="sc">$</span>tau,</span>
<span id="cb813-8"><a href="em.html#cb813-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mod_.1 =</span> ss_mod_<span class="fl">.1</span><span class="sc">$</span>tau</span>
<span id="cb813-9"><a href="em.html#cb813-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb813-10"><a href="em.html#cb813-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> series, <span class="at">y =</span> inflation)) <span class="sc">+</span></span>
<span id="cb813-11"><a href="em.html#cb813-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&#39;gray50&#39;</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb813-12"><a href="em.html#cb813-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Mod_1),  <span class="at">color =</span> <span class="st">&#39;#ff5500&#39;</span>) <span class="sc">+</span></span>
<span id="cb813-13"><a href="em.html#cb813-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Mod_<span class="fl">.5</span>), <span class="at">color =</span> <span class="st">&#39;#9E1B34&#39;</span>) <span class="sc">+</span></span>
<span id="cb813-14"><a href="em.html#cb813-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Mod_<span class="fl">.1</span>), <span class="at">color =</span> <span class="st">&#39;#00aaff&#39;</span>) <span class="sc">+</span></span>
<span id="cb813-15"><a href="em.html#cb813-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb813-16"><a href="em.html#cb813-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">&#39;gp&#39;</span>, <span class="at">k =</span> <span class="dv">50</span>),</span>
<span id="cb813-17"><a href="em.html#cb813-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb813-18"><a href="em.html#cb813-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&#39;#1b9e86&#39;</span>,</span>
<span id="cb813-19"><a href="em.html#cb813-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&#39;gam&#39;</span>,</span>
<span id="cb813-20"><a href="em.html#cb813-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">5</span></span>
<span id="cb813-21"><a href="em.html#cb813-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb813-22"><a href="em.html#cb813-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&#39;10 years&#39;</span>) <span class="sc">+</span></span>
<span id="cb813-23"><a href="em.html#cb813-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p><img src="model-demos_files/figure-html/em-ssm-vis-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="source-48" class="section level3">
<h3>Source</h3>
<p>Original code found at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20for%20state%20space%20unobserved%20components.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/EM%20Examples/EM%20for%20state%20space%20unobserved%20components.R</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="nelder-mead.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gradient-descent.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["twitter", "facebook", "linkedin", "google", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/m-clark/models-by-example/blob/master/em.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"depth": 2,
"scroll_highlight": true
},
"df_print": "kable",
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
